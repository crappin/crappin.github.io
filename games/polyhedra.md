<b><a href="data:text/html;base64, PCEtLUhUTUw6IGh0bWwuaHRtbC0tPgo8IURPQ1RZUEUgaHRtbD4KPGh0bWw+Cgo8aGVhZD4KICAgIDxtZXRhIGNoYXJzZXQ9InV0Zi04Ij4KICAgIDx0aXRsZT5Ud2lzdHkgUG9seWhlZHJhPC90aXRsZT4KICAgIDxzdHlsZT4KICAgICAgICAqIHsKICAgICAgICAgICAgLXdlYmtpdC11c2VyLXNlbGVjdDogbm9uZTsKICAgICAgICAgICAgLW1vei11c2VyLXNlbGVjdDogbm9uZTsKICAgICAgICAgICAgLW1zLXVzZXItc2VsZWN0OiBub25lOwogICAgICAgICAgICB1c2VyLXNlbGVjdDogbm9uZTsKICAgICAgICB9CiAgICAgICAgY2FudmFzIHsKICAgICAgICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICAgIH0KICAgIDwvc3R5bGU+CjwvaGVhZD4KCjxib2R5IHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOiAjMjAyMDIwOyBjb2xvcjogd2hpdGU7IHRleHQtYWxpZ246IGNlbnRlcjsgbWluLXdpZHRoOiAxMDI0cHg7Ij4KICAgIDxkaXYgaWQ9InN1Y2Nlc3MiIHN0eWxlPSJkaXNwbGF5OiBub25lOyB2ZXJ0aWNhbC1hbGlnbjogdG9wOyB3aWR0aDogMzk0cHg7IG1hcmdpbi10b3A6IDEwMHB4OyBib3JkZXI6IDNweCBzb2xpZCBza3libHVlOyBib3JkZXItcmFkaXVzOiAyMHB4OyI+CiAgICAgICAgPGgyIHN0eWxlPSJwb3NpdGlvbjogcmVsYXRpdmU7IGZvbnQtZmFtaWx5OiBjdXJzaXZlIj4KICAgICAgICAgICAgQ29uZ3JhdHVsYXRpb25zIQogICAgICAgICAgICA8ZGl2IG9uY2xpY2s9Im1lbnUuc3R5bGUuZGlzcGxheT0naW5saW5lLWJsb2NrJztzdWNjZXNzLnN0eWxlLmRpc3BsYXk9J25vbmUnIiBzdHlsZT0iZm9udC1mYW1pbHk6IGZhbnRhc3k7OwogICAgICAgICAgICAgICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiAwcHg7CiAgICAgICAgICAgICAgICAgICAgICAgIHJpZ2h0OiAyMHB4OwogICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogcmVkOyI+WDwvZGl2PgogICAgICAgIDwvaDI+CiAgICAgICAgPHAgaWQ9Im1lc3NhZ2UiPjwvcD4KICAgIDwvZGl2PgogICAgPGRpdiBpZD0iaGVscCIgc3R5bGU9ImRpc3BsYXk6IG5vbmU7IHZlcnRpY2FsLWFsaWduOiB0b3A7IHdpZHRoOiAzOTRweDsgbWFyZ2luLXRvcDogNTBweDsgYm9yZGVyOiAzcHggc29saWQgc2t5Ymx1ZTsgYm9yZGVyLXJhZGl1czogMjBweDsiPgogICAgICAgIDxoMiBzdHlsZT0iZm9udC1mYW1pbHk6IGN1cnNpdmU7IHBvc2l0aW9uOiByZWxhdGl2ZTsiPgogICAgICAgICAgICBIRUxQCiAgICAgICAgICAgIDxkaXYgb25jbGljaz0ibWVudS5zdHlsZS5kaXNwbGF5PSdpbmxpbmUtYmxvY2snO2hlbHAuc3R5bGUuZGlzcGxheT0nbm9uZSciIHN0eWxlPSJmb250LWZhbWlseTpmYW50YXN5OwogICAgICAgICAgICAgICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiAwOwogICAgICAgICAgICAgICAgICAgICAgICByaWdodDogMjBweDsKICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IHJlZDsiPlg8L2Rpdj4KICAgICAgICA8L2gyPgogICAgICAgIDx1bCBzdHlsZT0ibWFyZ2luLXJpZ2h0OiAxMHB4Ij4KICAgICAgICAgICAgPGxpIHN0eWxlPSJ0ZXh0LWFsaWduOiBsZWZ0OyBtYXJnaW4tYm90dG9tOiAxMHB4Ij4KICAgICAgICAgICAgICAgIFRvIHJvdGF0ZSB0aGUgcHV6emxlLCBwcmVzcyAoY3RybCArIGxlZnQgbW91c2UgYnV0dG9uKSBPUiByaWdodCBtb3VzZSBidXR0b24gb3ZlciBwdXp6bGUgJiBkcmFnIHRoZSBtb3VzZS4KICAgICAgICAgICAgPC9saT4KICAgICAgICAgICAgPGxpIHN0eWxlPSJ0ZXh0LWFsaWduOiBsZWZ0OyBtYXJnaW4tYm90dG9tOiAxMHB4Ij4KICAgICAgICAgICAgICAgIFRvIHR3aXN0IGEgc2xpY2UsIHByZXNzIGxlZnQgbW91c2UgYnV0dG9uIG92ZXIgYSBzdGlja2VyICYgZHJhZyB0aGUgbW91c2UuCiAgICAgICAgICAgIDwvbGk+CiAgICAgICAgICAgIDxsaSBzdHlsZT0idGV4dC1hbGlnbjogbGVmdDsgbWFyZ2luLWJvdHRvbTogMTBweCI+CiAgICAgICAgICAgICAgICBDbGljayBvbiBhbnkgcHV6emxlIGluIHRoZSBtZW51IHRvIHNlbGVjdCBpdCAmIFRyaWdnZXIgYXV0b21hdGljIHNjcmFtYmxlIHVzaW5nIHRoZSBwbGF5IGJ1dHRvbi4KICAgICAgICAgICAgPC9saT4KICAgICAgICA8L3VsPgogICAgICAgIDxoMiBzdHlsZT0iZm9udC1mYW1pbHk6IGN1cnNpdmUiPgogICAgICAgICAgICBIYXBweSBTb2x2aW5nIQogICAgICAgIDwvaDI+CiAgICA8L2Rpdj4KICAgIDxkaXYgaWQ9Im1lbnUiIHN0eWxlPSJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IHZlcnRpY2FsLWFsaWduOiB0b3A7IG1hcmdpbi10b3A6IDUwcHg7IHdpZHRoOiA0MDBweCI+CiAgICAgICAgPGRpdiBpZD0icHV6emxlbWVudSIgc3R5bGU9ImRpc3BsYXk6IGlubGluZS1ibG9jazsgaGVpZ2h0OiAzMDBweDsiPgogICAgICAgICAgICA8ZGl2IGlkPSJzaGFwZW1lbnUiIHN0eWxlPSJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGhlaWdodDogMzAwcHg7Ij4KICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImhlaWdodDogMTAwcHg7Ij4KICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmlubGluZS1ibG9jazsgd2lkdGg6IDEwMHB4OyBoZWlnaHQ6IDEwMHB4OyI+PGNhbnZhcyBpZD0idGV0cmFoZWRyb24iIHdpZHRoPSIxMDBweCIgaGVpZ2h0PSIxMDBweCI+PC9jYW52YXM+PC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImhlaWdodDogMTAwcHg7Ij4KICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmlubGluZS1ibG9jazsgd2lkdGg6IDEwMHB4OyBoZWlnaHQ6IDEwMHB4OyBtYXJnaW4tcmlnaHQ6IDgwcHg7Ij48Y2FudmFzIGlkPSJjdWJlIiB3aWR0aD0iMTAwcHgiIGhlaWdodD0iMTAwcHgiPjwvY2FudmFzPjwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6aW5saW5lLWJsb2NrOyB3aWR0aDogMTAwcHg7IGhlaWdodDogMTAwcHg7Ij48Y2FudmFzIGlkPSJvY3RhaGVkcm9uIiB3aWR0aD0iMTAwcHgiIGhlaWdodD0iMTAwcHgiPjwvY2FudmFzPjwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJoZWlnaHQ6IDEwMHB4OyI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTppbmxpbmUtYmxvY2s7IHdpZHRoOiAxMDBweDsgaGVpZ2h0OiAxMDBweDsgbWFyZ2luLXJpZ2h0OiAyMHB4OyBtYXJnaW4tdG9wOiAxNXB4OyI+PGNhbnZhcyBpZD0iZG9kZWNhaGVkcm9uIiB3aWR0aD0iMTAwcHgiIGhlaWdodD0iMTAwcHgiPjwvY2FudmFzPjwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6aW5saW5lLWJsb2NrOyB3aWR0aDogMTAwcHg7IGhlaWdodDogMTAwcHg7Ij48Y2FudmFzIGlkPSJpY29zYWhlZHJvbiIgd2lkdGg9IjEwMHB4IiBoZWlnaHQ9IjEwMHB4Ij48L2NhbnZhcz48L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBpZD0ic2l6ZW1lbnUiIHN0eWxlPSJoZWlnaHQ6IDMwMHB4OyBtYXJnaW4tdG9wOiAxNXB4OyI+CiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IHZlcnRpY2FsLWFsaWduOiB0b3A7IG1hcmdpbi10b3A6IDEwMHB4Ij4KICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJ3aWR0aDogMTAwcHg7IGhlaWdodDogMTAwcHg7Ij48Y2FudmFzIGlkPSJzaXplLTEiIHdpZHRoPSIxMDBweCIgaGVpZ2h0PSIxMDBweCI+PC9jYW52YXM+PC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9InZlcnRpY2FsLWFsaWduOiB0b3AiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6IGlubGluZS1ibG9jazsgd2lkdGg6IDEwMHB4OyBoZWlnaHQ6IDEwMHB4OyI+PGNhbnZhcyBpZD0ic2l6ZS0yIiB3aWR0aD0iMTAwcHgiIGhlaWdodD0iMTAwcHgiPjwvY2FudmFzPjwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6IGlubGluZS1ibG9jazsgd2lkdGg6IDEwMHB4OyBoZWlnaHQ6IDEwMHB4OyI+PGNhbnZhcyBpZD0ic2l6ZS0zIiB3aWR0aD0iMTAwcHgiIGhlaWdodD0iMTAwcHgiPjwvY2FudmFzPjwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgaWQ9ImNvbmZpZ3VyYXRpb25tZW51IiBzdHlsZT0idmVydGljYWwtYWxpZ246IHRvcDsgdGV4dC1hbGlnbjogbGVmdDsgaGVpZ2h0OiAzMDBweDsgbWFyZ2luLXRvcDogMTlweDsgZGlzcGxheTogbm9uZTsiPgogICAgICAgICAgICA8ZGl2IHN0eWxlPSJib3JkZXI6IDNweCBzb2xpZCB3aGl0ZTsgcGFkZGluZzogNDBweDsgbWFyZ2luLXRvcDogMTAwcHg7IGJvcmRlci1yYWRpdXM6IDEwJTsiPgogICAgICAgICAgICAgICAgPGlucHV0IGF1dG9jb21wbGV0ZT0ib2ZmIiBjaGVja2VkPSIiIHR5cGU9ImNoZWNrYm94IiB2YWx1ZT0iZXhwIiBpZD0iZXhzdGljayIgbmFtZT0iZXhzdGljayIgb25jbGljaz0id2luZG93LmV4cGxvZGVkU3RpY2tlcnM9IXdpbmRvdy5leHBsb2RlZFN0aWNrZXJzIj4KICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9ImV4c3RpY2siPkV4cGxvZGUgU3RpY2tlcnM8L2xhYmVsPgogICAgICAgICAgICAgICAgPGJyPgogICAgICAgICAgICAgICAgPGlucHV0IGF1dG9jb21wbGV0ZT0ib2ZmIiB0eXBlPSJjaGVja2JveCIgdmFsdWU9InN0YXQiIGlkPSJzdGF0Y29uZmlnIiBuYW1lPSJzdGF0Y29uZmlnIiBvbmNsaWNrPSJzdGF0cy5zdHlsZS5kaXNwbGF5PShzdGF0cy5zdHlsZS5kaXNwbGF5ID09PSAnbm9uZScgPyAnaW5saW5lJyA6ICdub25lJykiPgogICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0ic3RhdGNvbmZpZyI+U2hvdyBTdGF0czwvbGFiZWw+CiAgICAgICAgICAgICAgICA8YnI+CiAgICAgICAgICAgICAgICA8aW5wdXQgYXV0b2NvbXBsZXRlPSJvZmYiIHR5cGU9ImNoZWNrYm94IiB2YWx1ZT0icmVhcnYiIGlkPSJyZWFydmNvbmYiIG5hbWU9InJlYXJ2Y29uZiIgb25jbGljaz0id2luZG93LnNob3dSZWFyVmlldz0hd2luZG93LnNob3dSZWFyVmlldzsgcmVhclZpZXcuc3R5bGUuZGlzcGxheT0od2luZG93LnNob3dSZWFyVmlldyA/ICdpbmxpbmUtYmxvY2snIDogJ25vbmUnKSI+CiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJyZWFydmNvbmYiPlNob3cgUmVhciBWaWV3PC9sYWJlbD4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBzdHlsZT0ibWFyZ2luOiA1MHB4IDY1cHg7Zm9udC1zaXplOjQwcHg7Ij4KICAgICAgICAgICAgPHNwYW4gb25jbGljaz0iaGVscC5zdHlsZS5kaXNwbGF5PSdpbmxpbmUtYmxvY2snO21lbnUuc3R5bGUuZGlzcGxheT0nbm9uZSciIHN0eWxlPSJjdXJzb3I6IHBvaW50ZXI7IGZsb2F0OiBsZWZ0OyB3aWR0aDogNTBweDsgaGVpZ2h0OiA1MHB4OyBjb2xvcjogc2t5Ymx1ZSI+Pzwvc3Bhbj4KICAgICAgICAgICAgPHNwYW4gaWQ9InNldHRpbmdzbWVudWJ1dHRvbiIgb25jbGljaz0icHV6emxlbWVudS5zdHlsZS5kaXNwbGF5PXNldHRpbmdzbWVudWJ1dHRvbi5zdHlsZS5kaXNwbGF5PSdub25lJztjb25maWd1cmF0aW9ubWVudS5zdHlsZS5kaXNwbGF5PXB1enpsZW1lbnVidXR0b24uc3R5bGUuZGlzcGxheT0naW5saW5lLWJsb2NrJzsiIHN0eWxlPSJjdXJzb3I6IHBvaW50ZXI7IHdpZHRoOiA1MHB4OyBoZWlnaHQ6IDUwcHgiPiYjOTg4MTs8L3NwYW4+CiAgICAgICAgICAgIDxzcGFuIGlkPSJwdXp6bGVtZW51YnV0dG9uIiBvbmNsaWNrPSJzaG93U2hhcGVNZW51KCk7IiBzdHlsZT0iY3Vyc29yOiBwb2ludGVyOyB3aWR0aDogNTBweDsgaGVpZ2h0OiA1MHB4OyBkaXNwbGF5OiBub25lOyBjb2xvcjogcmVkIj4mIzk2NjU7PC9zcGFuPgogICAgICAgICAgICA8c3BhbiBpZD0ic3RhcnRidXR0b24iIG9uY2xpY2s9InNlbGVjdGVkUHV6emxlLnNjcmFtYmxlKCk7c3RhcnRidXR0b24uc3R5bGUudmlzaWJpbGl0eT0naGlkZGVuJyIgc3R5bGU9ImN1cnNvcjogcG9pbnRlcjsgZmxvYXQ6cmlnaHQ7IHdpZHRoOiA1MHB4OyBoZWlnaHQ6IDUwcHg7IGNvbG9yOiBsYXduZ3JlZW4iPiYjOTY1NDs8L3NwYW4+CiAgICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6IGlubGluZS1ibG9jayI+CiAgICAgICAgPGNhbnZhcyBpZD0iZ2FtZUNhbnZhcyIgd2lkdGg9IjYwMHB4IiBoZWlnaHQ9IjYwMHB4Ij48L2NhbnZhcz4KICAgICAgICA8c3BhbiBpZD0ic3RhdHMiIHN0eWxlPSJwb3NpdGlvbjogZml4ZWQ7IHJpZ2h0OiA1MHB4OyBkaXNwbGF5OiBub25lIj5UaW1lIFRha2VuOiAtLTotLSwgTW92ZXMgTWFkZTogLS08L3NwYW4+CiAgICA8L2Rpdj4KICAgIDxkaXYgaWQ9InJlYXJWaWV3IiBzdHlsZT0icG9zaXRpb246IGZpeGVkOyBkaXNwbGF5OiBub25lOyByaWdodDogMHB4OyB0b3A6IDIwcHgiPgogICAgICAgIDxjYW52YXMgaWQ9ImdhbWVDYW52YXNJbnZlcnRlZCIgd2lkdGg9IjIwMHB4IiBoZWlnaHQ9IjIwMHB4Ij48L2NhbnZhcz4KICAgIDwvZGl2PgogICAgPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPgogICAgd2luZG93Lm1vZCA9IGZ1bmN0aW9uKG4sIG0pIHsKICAgICAgICByZXR1cm4gKChuICUgbSkgKyBtKSAlIG07CiAgICB9CiAgICA8L3NjcmlwdD4KICAgIDxzY3JpcHQgdHlwZT0iYXBwbGljYXRpb24vamF2YXNjcmlwdCI+Y29uc3Qgb3JpZ2luID0geyB4OiAwLCB5OiAwLCB6OiAwIH07CgovLyBVc2VmdWwgVmVjdG9yIG9wZXJhdGlvbnMKY2xhc3MgVmVjdG9yIHsKICAgIC8vIENyZWF0ZXMgdmVjdG9yIGZyb20gcG9pbnQgJ3AnIHRvIHBvaW50ICdxJwogICAgLy8gSWYgJ3EnIGlzIG5vdCBwcm92aWRlZCwgVmVjdG9yIGZyb20gb3JpZ2luIHRvIHBvaW50ICdwJyBpcyBjcmVhdGVkIGluc3RlYWQKICAgIGNvbnN0cnVjdG9yKHAsIHEpIHsKICAgICAgICBpZiAoIXEpIHsKICAgICAgICAgICAgcSA9IHA7CiAgICAgICAgICAgIHAgPSBvcmlnaW47CiAgICAgICAgfQogICAgICAgIHRoaXMueCA9IHEueCAtIHAueDsKICAgICAgICB0aGlzLnkgPSBxLnkgLSBwLnk7CiAgICAgICAgdGhpcy56ID0gcS56IC0gcC56OwogICAgfQoKICAgIC8vIFZlY3RvciBhZGRpdGlvbgogICAgYWRkKHYpIHsKICAgICAgICByZXR1cm4gbmV3IFZlY3RvcigKICAgICAgICAgICAgb3JpZ2luLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB4OiB0aGlzLnggKyB2LngsCiAgICAgICAgICAgICAgICB5OiB0aGlzLnkgKyB2LnksCiAgICAgICAgICAgICAgICB6OiB0aGlzLnogKyB2LnoKICAgICAgICAgICAgfQogICAgICAgICk7CiAgICB9CgogICAgLy8gVmVjdG9yIHN1YnRyYWN0aW9uCiAgICBzdWJ0cmFjdCh2KSB7CiAgICAgICAgcmV0dXJuIHRoaXMuYWRkKHsgeDogLXYueCwgeTogLXYueSwgejogLXYueiB9KTsKICAgIH0KCiAgICAvLyBNdWx0aXBsaWNhdGlvbiBieSBhIHNjYWxhcgogICAgbXVsdGlwbHkocykgewogICAgICAgIHJldHVybiBuZXcgVmVjdG9yKAogICAgICAgICAgICBvcmlnaW4sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHg6IHRoaXMueCAqIHMsCiAgICAgICAgICAgICAgICB5OiB0aGlzLnkgKiBzLAogICAgICAgICAgICAgICAgejogdGhpcy56ICogcwogICAgICAgICAgICB9CiAgICAgICAgKTsKICAgIH0KCiAgICAvLyBDYWxjdWxhdGUgdmVjdG9yIGxlbmd0aAogICAgbWFnbml0dWRlKCkgewogICAgICAgIHJldHVybiBNYXRoLnNxcnQodGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56KTsKICAgIH0KCiAgICAvLyBVbml0IHZlY3RvciBpbiBkaXJlY3Rpb24gb2YgY3VycmVudCB2ZWN0b3IKICAgIHVuaXQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubXVsdGlwbHkoMSAvIHRoaXMubWFnbml0dWRlKCkpOwogICAgfQoKICAgIC8vIENyb3NzIHByb2R1Y3Qgd2l0aCBhbm90aGVyIHZlY3RvcgogICAgY3Jvc3ModikgewogICAgICAgIHJldHVybiBuZXcgVmVjdG9yKAogICAgICAgICAgICBvcmlnaW4sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHg6IHRoaXMueSAqIHYueiAtIHRoaXMueiAqIHYueSwKICAgICAgICAgICAgICAgIHk6IHRoaXMueiAqIHYueCAtIHRoaXMueCAqIHYueiwKICAgICAgICAgICAgICAgIHo6IHRoaXMueCAqIHYueSAtIHRoaXMueSAqIHYueAogICAgICAgICAgICB9CiAgICAgICAgKTsKICAgIH0KfQoKPC9zY3JpcHQ+CiAgICA8c2NyaXB0IHR5cGU9ImFwcGxpY2F0aW9uL2phdmFzY3JpcHQiPi8vIFVzZWZ1bCBRdWF0ZXJuaW9uIG9wZXJhdGlvbnMgKHJlZmVyZW5jZTogaHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1kNEVnYmdUbTBCZykKLy8gUXVhdGVybmlvbnMgYXJlIDREIGV4dGVuc2lvbnMgdG8gY29tcGxleCBudW1iZXJzIHVzZWQgdG8gcmVwcmVzZW50IDNEIHJvdGF0aW9ucyBpbiB0aGUgYXBwbGljYXRpb24KLy8gQWx0aG91Z2ggdGhlcmUgYXJlIG90aGVyIHdheXMgdG8gaW1wbGVtZW50IHJvdGF0aW9ucyBiYXNlZCBvbiBzdHJhaWdodCBmb3J3YXJkIDNEIGdlb21ldHJ5LCBRdWF0ZXJuaW9ucyBwcm92aWRlIGFuIGVsZWdhbnQgYXBwcm9hY2ggZm9yIHRoZSBzYW1lCgpjb25zdCBxRGltZW5zaW9ucyA9IFsndycsJ3gnLCd5JywneiddOwpjb25zdCBxUHJvZHVjdFNpZ24gPSBbCiAgICBbMSwxLDEsMV0sCiAgICBbMSwtMSwxLC0xXSwKICAgIFsxLC0xLC0xLDFdLAogICAgWzEsMSwtMSwtMV0KXTsKY29uc3QgcVByb2R1Y3RBeGlzID0gWwogICAgWzAsMSwyLDNdLAogICAgWzEsMCwzLDJdLAogICAgWzIsMywwLDFdLAogICAgWzMsMiwxLDBdCl07CgpjbGFzcyBRdWF0ZXJuaW9uIHsKICAgIGNvbnN0cnVjdG9yKHcsIHgsIHksIHopIHsKICAgICAgICB0aGlzLncgPSB3OwogICAgICAgIHRoaXMueCA9IHg7CiAgICAgICAgdGhpcy55ID0geTsKICAgICAgICB0aGlzLnogPSB6OwogICAgfQoKICAgIGNvbmp1Z2F0ZSgpIHsKICAgICAgICByZXR1cm4gbmV3IFF1YXRlcm5pb24odGhpcy53LCAtdGhpcy54LCAtdGhpcy55LCAtdGhpcy56KTsKICAgIH0KCiAgICBtdWx0aXBseShxKSB7CiAgICAgICAgY29uc3QgcHJvZHVjdCA9IG5ldyBRdWF0ZXJuaW9uKDAsMCwwLDApOwogICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgNDsgeCsrKQogICAgICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IDQ7IHkrKykKICAgICAgICAgICAgICAgIHByb2R1Y3RbcURpbWVuc2lvbnNbcVByb2R1Y3RBeGlzW3hdW3ldXV0gKz0gcVByb2R1Y3RTaWduW3hdW3ldICogdGhpc1txRGltZW5zaW9uc1t4XV0gKiBxW3FEaW1lbnNpb25zW3ldXTsKICAgICAgICByZXR1cm4gcHJvZHVjdDsKICAgIH0KfQoKPC9zY3JpcHQ+CiAgICA8c2NyaXB0IHR5cGU9ImFwcGxpY2F0aW9uL2phdmFzY3JpcHQiPi8vIEEgcG9pbnQgaXMganVzdCBhIGxvY2F0aW9uIGluIDNEIHNwYWNlIHdoaWNoIChvcHRpb25hbGx5KSBjb250YWlucyBhbiBpZAovLyBFdmVyeSBwb2ludCBvYmplY3QgcmVwcmVzZW50cyBhbiBvcmllbnRhdGlvbiBvZiBhIGJhc2UgbG9jYXRpb24gd2hpY2ggaXMgdXBkYXRlZCBhcyBwdXp6bGUgaXMgdHdpc3RlZCBvciByZS1vcmllbnRlZApjbGFzcyBQb2ludCB7CiAgICBjb25zdHJ1Y3Rvcih4LCB5LCB6LCBpZCkgewogICAgICAgIHRoaXMuYmFzZSA9IHsgeCwgeSwgeiB9OwogICAgICAgIHRoaXMueCA9IHg7CiAgICAgICAgdGhpcy55ID0geTsKICAgICAgICB0aGlzLnogPSB6OwogICAgICAgIHRoaXMuaWQgPSBpZDsKICAgIH0KCiAgICAvLyBVcGRhdGVzIHRoZSBwb2ludCBieSByZS1vcmllbnRpbmcgaXQgYWNjb3JkaW5nIHRvIHRoZSBnaXZlbiBheGlzICYgYW5nbGUKICAgIHVwZGF0ZShvcmllbnRhdGlvbikgewogICAgICAgIGxldCB7IHgsIHksIHogfSA9IHRoaXMucm90YXRlQXJvdW5kQXhpcyh0aGlzLmJhc2UsIG9yaWVudGF0aW9uLmF4aXMudW5pdCgpLCBvcmllbnRhdGlvbi5hbmdsZSk7CiAgICAgICAgdGhpcy54ID0geDsKICAgICAgICB0aGlzLnkgPSB5OwogICAgICAgIHRoaXMueiA9IHo7CiAgICB9CgogICAgLy8gU2V0IHRoZSBvcmllbnRhdGlvbiBhcyB0aGUgbmV3IGJhc2Ugb3JpZW50YXRpb24gZm9yIHRoZSBwb2ludAogICAgc2F2ZU9yaWVudGF0aW9uKG9yaWVudGF0aW9uKSB7CiAgICAgICAgdGhpcy51cGRhdGUob3JpZW50YXRpb24pOwogICAgICAgIHRoaXMuYmFzZS54ID0gdGhpcy54OwogICAgICAgIHRoaXMuYmFzZS55ID0gdGhpcy55OwogICAgICAgIHRoaXMuYmFzZS56ID0gdGhpcy56OwogICAgfQoKICAgIGNsb25lKCkgewogICAgICAgIHJldHVybiBuZXcgUG9pbnQodGhpcy54LCB0aGlzLnksIHRoaXMueiwgdGhpcy5pZCk7CiAgICB9CgogICAgLy8gcm90YXRlIGdpdmVuIHBvaW50IGFib3V0IGFuIGFyYml0cmFyeSBheGlzLCBnaXZlbiB1bml0IHZlY3RvciBpbiB0aGUgZGlyZWN0aW9uIG9mIHRoZSBheGlzICYgYW5nbGUgJ2FscGhhJwogICAgLy8gcmVmZXJlbmNlczogaHR0cHM6Ly9lYXRlci5uZXQvcXVhdGVybmlvbnMgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvUXVhdGVybmlvbnNfYW5kX3NwYXRpYWxfcm90YXRpb24KICAgIHJvdGF0ZUFyb3VuZEF4aXMocG9pbnQsIHVuaXRWZWN0b3IsIGFscGhhKSB7CiAgICAgICAgY29uc3QgY0EgPSBNYXRoLmNvcyhhbHBoYSAvIDIpOwogICAgICAgIGNvbnN0IHNBID0gTWF0aC5zaW4oYWxwaGEgLyAyKTsKICAgICAgICBjb25zdCBxQSA9IG5ldyBRdWF0ZXJuaW9uKGNBLCBzQSAqIHVuaXRWZWN0b3IueCwgc0EgKiB1bml0VmVjdG9yLnkgLCBzQSAqIHVuaXRWZWN0b3Iueik7CiAgICAgICAgY29uc3QgcVAgPSBuZXcgUXVhdGVybmlvbigwLCBwb2ludC54LCBwb2ludC55LCBwb2ludC56KTsKICAgICAgICBjb25zdCBxUiA9IHFBLm11bHRpcGx5KHFQKS5tdWx0aXBseShxQS5jb25qdWdhdGUoKSk7CiAgICAgICAgcmV0dXJuIG5ldyBQb2ludChxUi54LCBxUi55LCBxUi56KTsKICAgIH0KfQoKPC9zY3JpcHQ+CiAgICA8c2NyaXB0IHR5cGU9ImFwcGxpY2F0aW9uL2phdmFzY3JpcHQiPi8vIEEgc3RpY2tlciBpcyBhIGNvbGxlY3Rpb24gb2YgcG9pbnRzLiBJdCdzIGEgcG9seWdvbiB3aXRoIGEgZmlsbCBjb2xvcgovLyBBIHN0aWNrZXIgaGFzIGEgbm9ybWFsIHZlY3RvciB0aGF0IHBvaW50cyBvdXRzaWRlIHRoZSBwdXp6bGUuIFRoaXMgaXMgaW1wbGllZCBieSBwb2ludCBvcmRlciAmIHJpZ2h0IGhhbmQgdGh1bWIgcnVsZQovLyBOb3QgdGhhdCB0aGlzIGlzIHRoZSBvbmx5IGNvbXBvbmVudCBvZiB0aGUgUHV6emxlIG9iamVjdCB3aGljaCBpcyBhY3R1YWxseSByZW5kZXJlZCBvbiB0aGUgY2FudmFzCmNsYXNzIFN0aWNrZXIgewogICAgY29uc3RydWN0b3IoaWQsIGNvbG9yLCBwb2ludHMpIHsKICAgICAgICB0aGlzLmlkID0gaWQ7CiAgICAgICAgdGhpcy5jb2xvciA9IGNvbG9yOwogICAgICAgIHRoaXMucG9pbnRzID0gcG9pbnRzOwogICAgICAgIHRoaXMuYXR0cmFjdG9yID0ge307CiAgICB9CgogICAgLy8gVG8gY2hlY2sgaWYgYSBzdGlja2VyIGNvbnRhaW5zIGEgcG9pbnQsIHdlIGNpcmNsZSBhcm91bmQgdGhlIHBvaW50cwogICAgLy8gcmV0dXJucyB0cnVlIGlmIGR1cmluZyB0aGUgd2hvbGUgdHJhdmVyc2FsIHRoZSBwb2ludCB3YXMgaW4gb25lIGRpcmVjdGlvbiBvZiB0aGUgY3VycmVudCB2ZWN0b3IgKGVpdGhlciBsZWZ0IG9yIHJpZ2h0KQogICAgLy8gcmV0dXJucyBmYWxzZSBvdGhlcndpc2UKICAgIC8vIFRoZSBsZWZ0L3JpZ2h0IHN0YXRlIGNhbiBiZSBjaGVjayBieSBwZXJmb3JtaW5nIGEgY3Jvc3MgcHJvZHVjdCBvZiB0aGUgY3VycmVudCBlZGdlIHZlY3RvciAmIHRoZSB2ZWN0b3IgZnJvbSBjdXJyZW50IGVkZ2Ugc3RhcnQgdG8gcGFyYW1ldGVyIHBvaW50CiAgICBjb250YWlucyhwKSB7CiAgICAgICAgbGV0IHUgPSB0aGlzLnBvaW50c1t0aGlzLnBvaW50cy5sZW5ndGggLSAxXSwgelByb2R1Y3QgPSAwLCBwcm9kdWN0OwogICAgICAgIGZvciAobGV0IHYgb2YgdGhpcy5wb2ludHMpIHsKICAgICAgICAgICAgcHJvZHVjdCA9IG5ldyBWZWN0b3IodSwgdikuY3Jvc3MobmV3IFZlY3Rvcih1LCBwKSk7CiAgICAgICAgICAgIGlmICgoelByb2R1Y3QgPCAwICYmIHByb2R1Y3QueiA+IDApIHx8ICh6UHJvZHVjdCA+IDAgJiYgcHJvZHVjdC56IDwgMCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfSBlbHNlIGlmIChwcm9kdWN0LnogIT09IDApIHsKICAgICAgICAgICAgICAgIHpQcm9kdWN0ID0gcHJvZHVjdC56OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHUgPSB2OwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyBOb3JtYWwgdmVjdG9yIGltcGxpZWQgYnkgcG9pbnQgb3JkZXIKICAgIGNhbGN1bGF0ZU5vcm1hbFZlY3RvcigpIHsKICAgICAgICByZXR1cm4gbmV3IFZlY3Rvcih0aGlzLnBvaW50c1swXSwgdGhpcy5wb2ludHNbMV0pLmNyb3NzKG5ldyBWZWN0b3IodGhpcy5wb2ludHNbMF0sIHRoaXMucG9pbnRzW3RoaXMucG9pbnRzLmxlbmd0aCAtIDFdKSk7CiAgICB9CgogICAgLy8gVXBkYXRlIGFsbCB0aGUgcG9pbnRzIGFjY29yZGluZyB0byBwYXJhbXMgJiBjYWxjdWNsYXRlIGF0dHJhY3RvcgogICAgLy8gQXR0cmFjdG9yIGlzIGp1c3QgdGhlIHN1bSBvZiBhbGwgcG9pbnQgdmVjdG9ycy4gVGhpcyBpcyB1c2VkIGZvciAiZXhwbG9kaW5nIiB0aGUgc3RpY2tlcnMKICAgIHVwZGF0ZShvcmllbnRhdGlvbikgewogICAgICAgIHRoaXMucG9pbnRzLmZvckVhY2gocG9pbnQgPT4gcG9pbnQudXBkYXRlKG9yaWVudGF0aW9uKSk7CiAgICAgICAgdGhpcy5hdHRyYWN0b3IgPSB7CiAgICAgICAgICAgICd4JzogdGhpcy5wb2ludHMucmVkdWNlKChhLCBwKSA9PiBhICsgcC54LCAwKSwKICAgICAgICAgICAgJ3knOiB0aGlzLnBvaW50cy5yZWR1Y2UoKGEsIHApID0+IGEgKyBwLnksIDApLAogICAgICAgICAgICAneic6IHRoaXMucG9pbnRzLnJlZHVjZSgoYSwgcCkgPT4gYSArIHAueiwgMCkKICAgICAgICB9OwogICAgfQoKICAgIC8vIFNpbXBsZSBwYXJhbGxlZCBwcm9qZWN0aW9uIChpZ25vcmUgdGhlIHotY29vcmRpbmF0ZXMpCiAgICAvLyBBbHNvLCBpZiBzdGlja2VyIGlzIGV4cGxvZGVkLCBtb3ZlIGl0J3MgcG9pbnRzIGEgbGl0dGxlIGJpdCBjbG9zZSB0byB0aGUgYXR0cmFjdG9yIGJlZm9yZSBwcm9qZWN0aW5nCiAgICBnZXRQb2ludFByb2plY3Rpb24ocG9pbnQsIGludmVydGVkLCBleHBsb2RlZCkgewogICAgICAgIGxldCByZXN1bHQgPSBbcG9pbnQueCwgcG9pbnQueV07CiAgICAgICAgaWYgKGV4cGxvZGVkKSB7CiAgICAgICAgICAgIC8vIElmIGluIHNvbWUgcHV6emxlIHNvbWUgc3RpY2tlcnMgaGF2ZSBtb3JlIHBvaW50cyB0aGFuIG90aGVycywgVGhlIG1hZ25pdHVkZSBvZiB0aGVpciBhdHRyYWN0b3Igd2lsbCBiZSBsYXJnZXIuCiAgICAgICAgICAgIC8vIFRvIG5vcm1hbGl6ZSB0aGUgb3V0d2FyZC1wdWxsLCB3ZSBkaXZpZGUgdGhlIHJlc3VsdCBieSBwb2ludHMubGVuZ3RoCiAgICAgICAgICAgIHJlc3VsdFswXSArPSAoKHRoaXMuYXR0cmFjdG9yLnggLSByZXN1bHRbMF0pIC8gKDEwICogdGhpcy5wb2ludHMubGVuZ3RoKSk7IC8vIHhBdHRyYWN0ZWQgPSB4T3JpZ2luYWwgKyAoeEF0dHJhY3RvciAtIHhPcmlnaW5hbCkgLyAoY29uc3RhbnQgKiBwb2ludHMubGVuZ3RoKQogICAgICAgICAgICByZXN1bHRbMV0gKz0gKCh0aGlzLmF0dHJhY3Rvci55IC0gcmVzdWx0WzFdKSAvICgxMCAqIHRoaXMucG9pbnRzLmxlbmd0aCkpOyAvLyB5QXR0cmFjdGVkID0geU9yaWdpbmFsICsgKHlBdHRyYWN0b3IgLSB5T3JpZ2luYWwpIC8gKGNvbnN0YW50ICogcG9pbnRzLmxlbmd0aCkKICAgICAgICB9CiAgICAgICAgaWYgKGludmVydGVkKSByZXN1bHRbMF0gPSAtcmVzdWx0WzBdOyAvLyBVc2VkIGZvciByZWFyLXZpZXcKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICAgIC8vIFVzZSBjYW52YXMgbW92ZVRvICYgbGluZVRvIGZvciBkcmF3aW5nIHByb2plY3RlZCBzdGlja2VyCiAgICByZW5kZXIoY3R4LCBpbnZlcnRlZCwgZXhwbG9kZWQpIHsKICAgICAgICBjdHguZmlsbFN0eWxlID0gdGhpcy5jb2xvcjsKICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAiIzIwMjAyMCI7CiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgIGN0eC5tb3ZlVG8oLi4udGhpcy5nZXRQb2ludFByb2plY3Rpb24odGhpcy5wb2ludHNbMF0sIGludmVydGVkLCBleHBsb2RlZCkpOwogICAgICAgIHRoaXMucG9pbnRzLmZvckVhY2gocCA9PiBjdHgubGluZVRvKC4uLnRoaXMuZ2V0UG9pbnRQcm9qZWN0aW9uKHAsIGludmVydGVkLCBleHBsb2RlZCkpKTsKICAgICAgICBjdHguY2xvc2VQYXRoKCk7CiAgICAgICAgY3R4LmZpbGwoKTsKICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICB9Cn0KCjwvc2NyaXB0PgogICAgPHNjcmlwdCB0eXBlPSJhcHBsaWNhdGlvbi9qYXZhc2NyaXB0Ij4vLyBBIGZhY2UgaXMgSnVzdCBhIGNvbGxlY3Rpb24gb2Ygc3RpY2tlcnMuCi8vIEV2ZXJ5IHN0aWNrZXIgaW4gdGhlIGZhY2UgaGFzIGEgbm9ybWFsIHZlY3RvciBkZWZpbmVkIGJ5IHRoZSBwb2ludCBvcmRlciAod2hpY2ggaXMgZXhwZWN0ZWQgdG8gZm9sbG93IHRoZSByaWdodCBoYW5kIHRodW1iIHJ1bGUpCi8vIFRoZSBub3JtYWwgdmVjdG9yIG9mIHRoZSBmYWNlIGlzIGp1c3QgdGhlIG5vcm1hbCB2ZWN0b3Igb2YgYW55IG9mIGl0J3Mgc3RpY2tlcnMuCmNsYXNzIEZhY2UgewogICAgY29uc3RydWN0b3Ioc3RpY2tlcnMpIHsKICAgICAgICB0aGlzLnN0aWNrZXJzID0gc3RpY2tlcnM7CiAgICAgICAgdGhpcy5ub3JtYWxWZWN0b3IgPSB0aGlzLnN0aWNrZXJzWzBdLmNhbGN1bGF0ZU5vcm1hbFZlY3RvcigpOwogICAgfQoKICAgIHVwZGF0ZShvcmllbnRhdGlvbikgewogICAgICAgIHRoaXMuc3RpY2tlcnMuZm9yRWFjaChzdGlja2VyID0+IHN0aWNrZXIudXBkYXRlKG9yaWVudGF0aW9uKSk7CiAgICAgICAgdGhpcy5ub3JtYWxWZWN0b3IgPSB0aGlzLnN0aWNrZXJzWzBdLmNhbGN1bGF0ZU5vcm1hbFZlY3RvcigpOwogICAgfQoKICAgIHJlbmRlcihjdHgsIGludmVydGVkLCBleHBsb2RlZCkgewogICAgICAgIHRoaXMuc3RpY2tlcnMuZm9yRWFjaChzdGlja2VyID0+IHN0aWNrZXIucmVuZGVyKGN0eCwgaW52ZXJ0ZWQsIGV4cGxvZGVkKSk7CiAgICB9Cn0KCjwvc2NyaXB0PgogICAgPHNjcmlwdCB0eXBlPSJhcHBsaWNhdGlvbi9qYXZhc2NyaXB0Ij4vLyBDbGFzcyByZXByZXNlbnRpbmcgdHdpc3RhYmxlIHNsaWNlcwovLyBBIHNpbmdsZSBjeWNsZSBjb250YWlucyBtdWx0aXBsZSBzdGlja2VyIGNvbGxlY3Rpb25zLiBFYWNoIG9mIHRoZW0gaXMgYSBzdWItY3ljbGUuCi8vIEJ5IGNvbnZlbnRpb24sIHRoZSBmaXJzdCBvZiB0aGVzZSBzdWItY3ljbGVzIGlzIHRoZSBtYWluIHNsaWNlLiBPdGhlciBzdWItY3ljbGVzIGNhbiBiZSB1c2VkIHRvIHJvdGF0ZSBhdHRhY2hlZCBmYWNlLgovLyBUaGUgcGVyaW9kIGlzIHRoZSBudW1iZSBvZiBvcGVyYXRpb25zIGFmdGVyIHdoaWNoIHRoZSB0d2lzdCBvcGVyYXRpb24gcmV2ZXJ0cyB0aGUgcHV6emxlIHRvIG9yaWdpbmFsIHN0YXRlCi8vIEEgY3ljbGUgYWxzbyBjb250YWlucyB1bml0IHZlY3RvciBub3JtYWwgdG8gaXQncyBwbGFuZSAmIGEgc2V0IG9mIHN0aWNrZXIgaWRzIGFmZnRlY3RlZCBieSBpdCBmb3IgcXVpY2sgbG9va3VwLgpjbGFzcyBDeWNsZSB7CiAgICBjb25zdHJ1Y3RvcihzdGlja2VyQ29sbGVjdGlvbnMsIHBlcmlvZCwgdW5pdFZlY3RvciwgYW5pbWF0aW9uQ29uZmlnKSB7CiAgICAgICAgdGhpcy5zdGlja2VyQ29sbGVjdGlvbnMgPSBzdGlja2VyQ29sbGVjdGlvbnM7CiAgICAgICAgdGhpcy5wZXJpb2QgPSBwZXJpb2Q7CiAgICAgICAgdGhpcy51bml0VmVjdG9yID0gdW5pdFZlY3RvcjsKICAgICAgICB0aGlzLmFuaW1hdGlvbkNvbmZpZyA9IGFuaW1hdGlvbkNvbmZpZzsKICAgICAgICB0aGlzLnN0aWNrZXJDb3ZlciA9IHt9OwogICAgfQoKICAgIGNvbXB1dGVTdGlja2VyQ292ZXIoKSB7CiAgICAgICAgdGhpcy5zdGlja2VyQ29sbGVjdGlvbnMuZm9yRWFjaChjb2xsZWN0aW9uID0+IGNvbGxlY3Rpb24uZm9yRWFjaCgoeyBpZCB9KSA9PiB0aGlzLnN0aWNrZXJDb3ZlcltpZF0gPSB0cnVlKSk7CiAgICB9CgogICAgc2F2ZU9yaWVudGF0aW9uKG9yaWVudGF0aW9uKSB7CiAgICAgICAgY29uc3QgcCA9IG5ldyBQb2ludCh0aGlzLnVuaXRWZWN0b3IueCwgdGhpcy51bml0VmVjdG9yLnksIHRoaXMudW5pdFZlY3Rvci56KTsKICAgICAgICBwLnVwZGF0ZShvcmllbnRhdGlvbik7CiAgICAgICAgdGhpcy51bml0VmVjdG9yID0gbmV3IFZlY3RvcihwKTsKICAgIH0KCiAgICB0d2lzdChkaXJlY3Rpb24gPSAxKSB7CiAgICAgICAgdGhpcy5zdGlja2VyQ29sbGVjdGlvbnMuZm9yRWFjaChjb2xsZWN0aW9uID0+IHsKICAgICAgICAgICAgaWYgKGNvbGxlY3Rpb24ubGVuZ3RoID09PSAxKSByZXR1cm47CiAgICAgICAgICAgIGxldCBpbmNyZW1lbnQgPSBkaXJlY3Rpb24gKiBjb2xsZWN0aW9uLmxlbmd0aCAvIHRoaXMucGVyaW9kOwogICAgICAgICAgICBjb2xsZWN0aW9uLmZvckVhY2goKHN0aWNrZXIsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICBzdGlja2VyLm5ld0NvbG9yID0gY29sbGVjdGlvblttb2QoaW5kZXggLSBpbmNyZW1lbnQsIGNvbGxlY3Rpb24ubGVuZ3RoKV0uY29sb3I7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBjb2xsZWN0aW9uLmZvckVhY2goc3RpY2tlciA9PiB7CiAgICAgICAgICAgICAgICBzdGlja2VyLmNvbG9yID0gc3RpY2tlci5uZXdDb2xvcjsKICAgICAgICAgICAgICAgIGRlbGV0ZSBzdGlja2VyLm5ld0NvbG9yOwogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH0KfQo8L3NjcmlwdD4KICAgIDxzY3JpcHQgdHlwZT0iYXBwbGljYXRpb24vamF2YXNjcmlwdCI+Ly8gUHV6emxlIGNsYXNzIGFic3RyYWN0cyBvdXQgZmVhdHVyZXMgY29tbW9uIHRvIGV2ZXJ5IHR3aXN0eSBwb2x5aGVkcmEKLy8gMSkgSXQgaGFzIGZhY2VzLCB3aGljaCBhcmUganVzdCBjb2xsZWN0aW9ucyBvZiBzdGlja2VycwovLyAyKSBJdCBoYXMgY3ljbGVzLCB3aGljaCByZXByZXNlbnQgdGhlIHR3aXN0YWJsZSBzbGljZXMKY2xhc3MgUHV6emxlIHsKICAgIGNvbnN0cnVjdG9yKGZhY2VzLCBjeWNsZXMpIHsKICAgICAgICB0aGlzLmZhY2VzID0gZmFjZXM7CiAgICAgICAgdGhpcy5jeWNsZXMgPSBjeWNsZXM7CgogICAgICAgIHRoaXMudHdpc3RpbmcgPSB0aGlzLnJvdGF0aW5nID0gZmFsc2U7CiAgICAgICAgdGhpcy5zdGFydEV2dENvb3JkaW5hdGVzID0ge307CiAgICAgICAgdGhpcy5iYXNlT3JpZW50YXRpb24gPSB7CiAgICAgICAgICAgICdheGlzJzogbmV3IFZlY3Rvcih7IHg6IDEsIHk6IDAsIHo6IDB9KSwKICAgICAgICAgICAgJ2FuZ2xlJzogMAogICAgICAgIH07CiAgICAgICAgdGhpcy5hbmltYXRpb25TdGF0ZSA9IHsKICAgICAgICAgICAgYWN0aXZlOiBmYWxzZSwKICAgICAgICAgICAgY291bnRlcjogMCwKICAgICAgICAgICAgZGlyZWN0aW9uOiB1bmRlZmluZWQsCiAgICAgICAgICAgIGN5Y2xlOiB1bmRlZmluZWQKICAgICAgICB9OwoKICAgICAgICAvLyBXaGlsZSBhbmltYXRpbmcgdGhlIGN5Y2xlIHR3aXN0cywgY29udmV4IGZhY2Ugc3RydWN0dXJlcyBhcmUgdGVtcG9yYXJpbHkgYnJva2VuLCBzbyB3ZSBvcGVyYXRlIGRpcmVjdGx5IG9uIHN0aWNrZXJzCiAgICAgICAgdGhpcy5zdGlja2VycyA9IFtdLmNvbmNhdCguLi50aGlzLmZhY2VzLm1hcChmYWNlID0+IGZhY2Uuc3RpY2tlcnMpKTsKCiAgICAgICAgdGhpcy5zdGFydFRpbWUgPSB1bmRlZmluZWQ7CiAgICAgICAgdGhpcy5tb3Zlc01hZGUgPSAwOwoKICAgICAgICB0aGlzLmN5Y2xlTWFwID0ge307CiAgICAgICAgdGhpcy5wcm9jZXNzQ3ljbGVNYXAoKTsKICAgICAgICB0aGlzLnN0YXJ0U3RpY2tlciA9IHVuZGVmaW5lZDsKICAgIH0KCiAgICBpc1NvbHZlZCgpIHsKICAgICAgICBmb3IgKGxldCBmID0gMDsgZiA8IHRoaXMuZmFjZXMubGVuZ3RoOyBmKyspCiAgICAgICAgICAgIGZvciAobGV0IHMgPSAwOyBzIDwgdGhpcy5mYWNlc1tmXS5zdGlja2Vycy5sZW5ndGg7IHMrKykKICAgICAgICAgICAgICAgIGlmICh0aGlzLmZhY2VzW2ZdLnN0aWNrZXJzW3NdLmNvbG9yICE9PSB0aGlzLmZhY2VzW2ZdLnN0aWNrZXJzWzBdLmNvbG9yKSByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gRm9yIGZhc3QgbG9va3VwcyBvZiBjeWNsZXMgcGFzc2luZyB0aHJvdWdoIHNvbWUgc3RpY2tlcgogICAgcHJvY2Vzc0N5Y2xlTWFwKCkgewogICAgICAgIHRoaXMuY3ljbGVzLmZvckVhY2goY3ljbGUgPT4KICAgICAgICAgICAgY3ljbGUuc3RpY2tlckNvbGxlY3Rpb25zLmZvckVhY2goc3RpY2tlckNvbGxlY3Rpb24gPT4gewogICAgICAgICAgICAgICAgaWYgKHN0aWNrZXJDb2xsZWN0aW9uLmlzUHJpbWFyeSkgewogICAgICAgICAgICAgICAgICAgIHN0aWNrZXJDb2xsZWN0aW9uLmZvckVhY2goc3RpY2tlciA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3ljbGVNYXBbc3RpY2tlci5pZF0gPSB0aGlzLmN5Y2xlTWFwW3N0aWNrZXIuaWRdIHx8IFtdOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmN5Y2xlTWFwW3N0aWNrZXIuaWRdLnB1c2goY3ljbGUpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgKTsKICAgIH0KCiAgICAvLyBVcGRhdGUgd29ya3MgaW4gdHdvIG1vZGVzCiAgICAvLyAxKSBXaGVuIGEgc2xpY2UgdHdpc3QgaXMgYW5pbWF0ZWQsIGNvdmVyZWQgc3RpY2tlcnMgYXJlIHJvdGF0ZWQgYXJvdW5kIGN5Y2xlIGF4aXMgJiB0aGVuIHNvcnRlZCBieSBkZXB0aCAoc2xvdykKICAgIC8vIDIpIFdoZW4gdGhlIHB1enpsZSBpcyBub3QgY2hhbmdpbmcsIGZhY2Ugb3JpZW50YXRpb25zIGFyZSB1cGRhdGVkICYgc29ydGVkIGJ5IG5vcm1hbCB2ZWN0b3IgdmFsdWVzIChmYXN0KQogICAgdXBkYXRlKCkgewogICAgICAgIGlmICh0aGlzLmFuaW1hdGlvblN0YXRlLmFjdGl2ZSAmJiB0aGlzLmFuaW1hdGlvblN0YXRlLmNvdW50ZXIgPCB0aGlzLmFuaW1hdGlvblN0YXRlLmN5Y2xlLmFuaW1hdGlvbkNvbmZpZy5zdGVwcykgewogICAgICAgICAgICBsZXQgYWxwaGEgPSB0aGlzLmFuaW1hdGlvblN0YXRlLmRpcmVjdGlvbiAqIHRoaXMuYW5pbWF0aW9uU3RhdGUuY291bnRlciAqIHRoaXMuYW5pbWF0aW9uU3RhdGUuY3ljbGUuYW5pbWF0aW9uQ29uZmlnLmRBbHBoYTsKICAgICAgICAgICAgbGV0IG9yaWVudGF0aW9uID0geyAnYXhpcyc6IHRoaXMuYW5pbWF0aW9uU3RhdGUuY3ljbGUudW5pdFZlY3RvciwgJ2FuZ2xlJzogYWxwaGEgfTsKICAgICAgICAgICAgdGhpcy5zdGlja2Vycy5mb3JFYWNoKHN0aWNrZXIgPT4gewogICAgICAgICAgICAgICAgaWYgKHRoaXMuYW5pbWF0aW9uU3RhdGUuY3ljbGUuc3RpY2tlckNvdmVyW3N0aWNrZXIuaWRdKSB7CiAgICAgICAgICAgICAgICAgICAgc3RpY2tlci51cGRhdGUob3JpZW50YXRpb24pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5zdGlja2Vycy5zb3J0KChzMSwgczIpID0+IHMyLmF0dHJhY3Rvci56IC0gczEuYXR0cmFjdG9yLnopOwogICAgICAgICAgICB0aGlzLmFuaW1hdGlvblN0YXRlLmNvdW50ZXIrKzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmZhY2VzLmZvckVhY2goZmFjZSA9PiBmYWNlLnVwZGF0ZSh0aGlzLnVwZGF0ZWRPcmllbnRhdGlvbiB8fCB0aGlzLmJhc2VPcmllbnRhdGlvbikpOwogICAgICAgICAgICB0aGlzLmZhY2VzLnNvcnQoKGYxLCBmMikgPT4gZjIubm9ybWFsVmVjdG9yLnogLSBmMS5ub3JtYWxWZWN0b3Iueik7CiAgICAgICAgICAgIGlmICh0aGlzLmFuaW1hdGlvblN0YXRlLmFjdGl2ZSkgewogICAgICAgICAgICAgICAgdGhpcy5hbmltYXRpb25TdGF0ZS5jeWNsZS50d2lzdCh0aGlzLmFuaW1hdGlvblN0YXRlLmRpcmVjdGlvbik7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGFydFRpbWUgJiYgdGhpcy5pc1NvbHZlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkZpbmlzaCAmJiB0aGlzLm9uRmluaXNoKChuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHRoaXMuc3RhcnRUaW1lKSAvIDEwMDApOwogICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhcnRUaW1lID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZXNNYWRlID0gMDsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5zdGFydFRpbWUpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVzTWFkZSsrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuYW5pbWF0aW9uU3RhdGUuY2FsbGJhY2spIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFuaW1hdGlvblN0YXRlLmNhbGxiYWNrKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYW5pbWF0aW9uU3RhdGUuY291bnRlciA8IHRoaXMuYW5pbWF0aW9uU3RhdGUuY3ljbGUuYW5pbWF0aW9uQ29uZmlnLnN0ZXBzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnVwZGF0ZSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuYW5pbWF0aW9uU3RhdGUgPSB7CiAgICAgICAgICAgICAgICAgICAgYWN0aXZlOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBjb3VudGVyOiAwLAogICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgIGN5Y2xlOiB1bmRlZmluZWQKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8gRmluZHMgcmVmZXJlbmNlIHRvIHRoZSBzdGlja2VyIHdoaWNoIGlzIG9uIHRvcCAmIGNvdmVyZXMgY29vcmRpbmF0ZXMgKHgsIHkpCiAgICBmaW5kVG91Y2hlZFN0aWNrZXIoeCwgeSkgewogICAgICAgIGxldCBzdGlja2VyOwogICAgICAgIGZvciAobGV0IGYgPSB0aGlzLmZhY2VzLmxlbmd0aCAtIDE7IGYgPj0gMDsgZi0tKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmZhY2VzW2ZdLm5vcm1hbFZlY3Rvci56ID49IDApIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdGlja2VyID0gdGhpcy5mYWNlc1tmXS5zdGlja2Vycy5maW5kKHN0aWNrZXIgPT4gc3RpY2tlci5jb250YWlucyh7IHgsIHksIHo6IDAgfSkpOwogICAgICAgICAgICBpZiAoc3RpY2tlcikgewogICAgICAgICAgICAgICAgcmV0dXJuIHN0aWNrZXI7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8gR3JhYnMgdGhlIHB1enpsZSBmb3IgcmUtb3JpZW50aW5nIC8gdHdpc3RpbmcKICAgIGdyYWIoeCwgeSwgdHlwZSkgewogICAgICAgIHRoaXMuc3RhcnRFdnRDb29yZGluYXRlcy54ID0geDsKICAgICAgICB0aGlzLnN0YXJ0RXZ0Q29vcmRpbmF0ZXMueSA9IHk7CiAgICAgICAgaWYgKHR5cGUgPT0gMikgewogICAgICAgICAgICB0aGlzLnJvdGF0aW5nID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnN0YXJ0U3RpY2tlciA9IHRoaXMuZmluZFRvdWNoZWRTdGlja2VyKHgsIHkpOwogICAgICAgICAgICB0aGlzLnR3aXN0aW5nID0gISF0aGlzLnN0YXJ0U3RpY2tlcjsKICAgICAgICB9CiAgICB9CgogICAgLy8gUmUtb3JpZW50cyAvIGFwcGxpZXMgdGhlIHR3aXN0CiAgICBkcmFnKHgsIHkpIHsKICAgICAgICBpZiAodGhpcy5hbmltYXRpb25TdGF0ZS5hY3RpdmUpIHJldHVybjsKICAgICAgICBpZiAodGhpcy5yb3RhdGluZykgewogICAgICAgICAgICBsZXQgZHggPSAoeCAtIHRoaXMuc3RhcnRFdnRDb29yZGluYXRlcy54KSAvIDEwMDsKICAgICAgICAgICAgbGV0IGR5ID0gKHkgLSB0aGlzLnN0YXJ0RXZ0Q29vcmRpbmF0ZXMueSkgLyAxMDA7CiAgICAgICAgICAgIGlmIChkeCB8fCBkeSkgewogICAgICAgICAgICAgICAgLy8gcm90YXRlIHRoZSBwdXp6bGUgYXJvdW5kIG5vcm1hbCB2ZWN0b3IgdG8gdGhlIGN1cnNvciB2ZWN0b3IgKGluIHRoZSBwbGFuZSBvZiB0aGUgc2NyZWVuKQogICAgICAgICAgICAgICAgLy8gYnkgYW4gYW5nbGUgcHJvcG9ydGlvbmFsIHRvIGl0J3MgbWFnbml0dWRlCiAgICAgICAgICAgICAgICBsZXQgdiA9IG5ldyBWZWN0b3IoeyB4OiBkeSwgeTogLWR4LCB6OiAwIH0pOwogICAgICAgICAgICAgICAgdGhpcy51cGRhdGVkT3JpZW50YXRpb24gPSB7CiAgICAgICAgICAgICAgICAgICAgJ2F4aXMnOiB2LAogICAgICAgICAgICAgICAgICAgICdhbmdsZSc6IHYubWFnbml0dWRlKCkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHRoaXMudHdpc3RpbmcpIHsKICAgICAgICAgICAgbGV0IHYgPSBuZXcgVmVjdG9yKAogICAgICAgICAgICAgICAgbmV3IFBvaW50KHRoaXMuc3RhcnRFdnRDb29yZGluYXRlcy54LCB0aGlzLnN0YXJ0RXZ0Q29vcmRpbmF0ZXMueSwgMCksCiAgICAgICAgICAgICAgICBuZXcgUG9pbnQoeCwgeSwgMCkKICAgICAgICAgICAgKQogICAgICAgICAgICBpZiAodi5tYWduaXR1ZGUoKSA+IDIwKSB7CiAgICAgICAgICAgICAgICB0aGlzLmRldGVjdEN5Y2xlKHYpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8vIFRvIGRldGVjdCB0aGUgY3ljbGUgdG8gdHdpc3QsIFdlIGNyZWF0ZSBhIHZlY3RvciBmb3IgbW91c2UgbW92ZW1lbnQuCiAgICAvLyBUaGUgY3ljbGUgd2Ugd2FudCB0byB0d2lzdCBwYXNzZXMgdGhyb3VnaCB0aGUgY2xpY2tlZCBzdGlja2VyICYgZ2l2ZXMgdGhlIG1heGltdW0gY3Jvc3MgcHJvZHVjdCB3aXRoIGN1cnNvciB2ZWN0b3IKICAgIGRldGVjdEN5Y2xlKHYpIHsKICAgICAgICBpZiAoIXRoaXMuY3ljbGVNYXBbdGhpcy5zdGFydFN0aWNrZXIuaWRdKSByZXR1cm47CiAgICAgICAgbGV0IG14TWcgPSAwLCBteEN5Y2xlLCBteERpcmVjdGlvbjsKICAgICAgICB0aGlzLmN5Y2xlTWFwW3RoaXMuc3RhcnRTdGlja2VyLmlkXS5mb3JFYWNoKGN5Y2xlID0+IHsKICAgICAgICAgICAgbGV0IHVuaXRQb2ludCA9IG5ldyBQb2ludChjeWNsZS51bml0VmVjdG9yLngsIGN5Y2xlLnVuaXRWZWN0b3IueSwgY3ljbGUudW5pdFZlY3Rvci56KTsKICAgICAgICAgICAgdW5pdFBvaW50LnogPSAwOwogICAgICAgICAgICBsZXQgdkMgPSBuZXcgVmVjdG9yKHVuaXRQb2ludCk7CiAgICAgICAgICAgIGxldCBwcm9kdWN0ID0gdi5jcm9zcyh2Qyk7CiAgICAgICAgICAgIGlmIChteE1nIDwgcHJvZHVjdC5tYWduaXR1ZGUoKSkgewogICAgICAgICAgICAgICAgbXhNZyA9IHByb2R1Y3QubWFnbml0dWRlKCk7CiAgICAgICAgICAgICAgICBteEN5Y2xlID0gY3ljbGU7CiAgICAgICAgICAgICAgICBteERpcmVjdGlvbiA9IHByb2R1Y3QueiA+IDAgPyAtMSA6IDE7CiAgICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIHRoaXMuYW5pbWF0aW9uU3RhdGUgPSB7CiAgICAgICAgICAgIGFjdGl2ZTogdHJ1ZSwKICAgICAgICAgICAgY291bnRlcjogMCwKICAgICAgICAgICAgZGlyZWN0aW9uOiBteERpcmVjdGlvbiwKICAgICAgICAgICAgY3ljbGU6IG14Q3ljbGUKICAgICAgICB9OwogICAgICAgIHRoaXMucmVsZWFzZSgpOwogICAgfQoKICAgIC8vIHJlbGVhc2UgdGhlIHB1enpsZQogICAgcmVsZWFzZSgpIHsKICAgICAgICB0aGlzLnR3aXN0aW5nID0gdGhpcy5yb3RhdGluZyA9IGZhbHNlOwogICAgICAgIHRoaXMuc3RhcnRFdnRDb29yZGluYXRlcyA9IHt9OwogICAgICAgIGlmICh0aGlzLnVwZGF0ZWRPcmllbnRhdGlvbikgewogICAgICAgICAgICB0aGlzLnNhdmVPcmllbnRhdGlvbih0aGlzLnVwZGF0ZWRPcmllbnRhdGlvbik7CiAgICAgICAgICAgIHRoaXMudXBkYXRlZE9yaWVudGF0aW9uID0gdW5kZWZpbmVkOwogICAgICAgIH0KICAgICAgICB0aGlzLnN0YXJ0U3RpY2tlciA9IHVuZGVmaW5lZDsKICAgIH0KCiAgICAvLyBTZXQgdGhlIG9yaWVudGF0aW9uIGFzIHRoZSBuZXcgYmFzZSBvcmllbnRhdGlvbiBmb3IgdGhlIHB1enpsZQogICAgc2F2ZU9yaWVudGF0aW9uKG9yaWVudGF0aW9uKSB7CiAgICAgICAgdGhpcy5zdGlja2Vycy5mb3JFYWNoKHN0aWNrZXIgPT4gc3RpY2tlci5wb2ludHMuZm9yRWFjaChwb2ludCA9PiBwb2ludC5zYXZlT3JpZW50YXRpb24ob3JpZW50YXRpb24pKSk7CiAgICAgICAgdGhpcy5jeWNsZXMuZm9yRWFjaChjeWNsZSA9PiBjeWNsZS5zYXZlT3JpZW50YXRpb24ob3JpZW50YXRpb24pKTsKICAgIH0KCiAgICAvLyBBcHBseSByYW5kb20gdHdpc3RzCiAgICBzY3JhbWJsZSgpIHsKICAgICAgICBjb25zdCBjb3VudCA9IHRoaXMuY3ljbGVzLmxlbmd0aCAqIDM7CiAgICAgICAgY29uc3QgdHdpc3RzID0gW107CiAgICAgICAgZm9yIChsZXQgYyA9IDA7IGMgPCBjb3VudDsgYysrKQogICAgICAgICAgICB0d2lzdHMucHVzaCh7IGN5Y2xlOiB0aGlzLmN5Y2xlc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB0aGlzLmN5Y2xlcy5sZW5ndGgpXSwgZGlyZWN0aW9uOiBNYXRoLnJhbmRvbSgpIDwgMC41ID8gLTEgOiAxIH0pOwogICAgICAgIGNvbnN0IGFuaW1hdGlvbkNvbmZpZ3MgPSBbXTsKICAgICAgICB0d2lzdHMuZm9yRWFjaCgoeyBjeWNsZSwgZGlyZWN0aW9uIH0sIGluZGV4KSA9PiB7CiAgICAgICAgICAgIGlmIChpbmRleCAmJiAoY3ljbGUgPT09IHR3aXN0c1tpbmRleCAtIDFdLmN5Y2xlKSkgZGlyZWN0aW9uID0gdHdpc3RzW2luZGV4IC0gMV0uZGlyZWN0aW9uOwogICAgICAgICAgICBhbmltYXRpb25Db25maWdzLnB1c2goewogICAgICAgICAgICAgICAgYWN0aXZlOiB0cnVlLCBjb3VudGVyOiAwLCBkaXJlY3Rpb24sIGN5Y2xlLAogICAgICAgICAgICAgICAgY2FsbGJhY2s6IGluZGV4IDwgY291bnQgLSAxID8gKCkgPT4gdGhpcy5hbmltYXRpb25TdGF0ZSA9IGFuaW1hdGlvbkNvbmZpZ3NbaW5kZXggKyAxXSA6ICgpID0+IHRoaXMuc3RhcnRUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCkKICAgICAgICAgICAgfSkKICAgICAgICB9KTsKICAgICAgICB0aGlzLmFuaW1hdGlvblN0YXRlID0gYW5pbWF0aW9uQ29uZmlnc1swXTsKICAgIH0KCiAgICAvLyBJZiBhbmltYXRpbmcsIHVzZSBkZXB0aCBzb3J0ZWQgc3RpY2tlcnMgdG8gcmVuZGVyCiAgICAvLyBJZiBub3QgYW5pbWF0aW5nLCB1c2Ugc29ydGVkIGZhY2VzIHRvIHJlbmRlcgogICAgcmVuZGVyKGN0eCwgaW52ZXJ0ZWQsIGV4cGxvZGVkID0gdHJ1ZSkgewogICAgICAgIGlmICghdGhpcy5hbmltYXRpb25TdGF0ZS5hY3RpdmUpIHsKICAgICAgICAgICAgbGV0IFtzdGFydCwgZW5kLCBzdGVwXSA9ICFpbnZlcnRlZCA/IFswLCB0aGlzLmZhY2VzLmxlbmd0aCwgMV0gOiBbdGhpcy5mYWNlcy5sZW5ndGggLSAxLCAtMSwgLTFdOwogICAgICAgICAgICBmb3IgKHZhciBpID0gc3RhcnQ7IGkgIT09IGVuZDsgaSArPSBzdGVwKSB0aGlzLmZhY2VzW2ldLnJlbmRlcihjdHgsIGludmVydGVkLCBleHBsb2RlZCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbGV0IFtzdGFydCwgZW5kLCBzdGVwXSA9ICFpbnZlcnRlZCA/IFswLCB0aGlzLnN0aWNrZXJzLmxlbmd0aCwgMV0gOiBbdGhpcy5zdGlja2Vycy5sZW5ndGggLSAxLCAtMSwgLTFdOwogICAgICAgICAgICBmb3IgKHZhciBpID0gc3RhcnQ7IGkgIT09IGVuZDsgaSArPSBzdGVwKSB0aGlzLnN0aWNrZXJzW2ldLnJlbmRlcihjdHgsIGludmVydGVkLCBleHBsb2RlZCk7CiAgICAgICAgfQogICAgfQp9Cgo8L3NjcmlwdD4KICAgIDxzY3JpcHQgdHlwZT0iYXBwbGljYXRpb24vamF2YXNjcmlwdCI+Ly8gRGVmaW5pdGlvbiBvZiBjdWJlIHNoYXBlZCBwdXp6bGVzCi8vIEdyaWQgOiBzdXJmYWNlIG9mIHRoZSBjdWJlCi8vIEZhY2VzIDogNiBTcXVhcmUgZmFjZXMKLy8gQ3ljbGVzIDogKDMgKiBzaXplKSBudW1iZXIgb2YgY3ljbGVzIGNvbnNpc3Rpbmcgb2YgMSBzdWIgY3ljbGUgZm9yIHRoZSBzbGljZSAmIHBvc3NpYmx5IG90aGVycyBmb3IgYXR0YWNoZWQgZmFjZQpjbGFzcyBDdWJlIGV4dGVuZHMgUHV6emxlIHsKICAgIGNvbnN0cnVjdG9yKHNpemUgPSAyLCBmdWxsU3BhbiA9IDI1MCkgewogICAgICAgIGNvbnN0IHdpZHRoID0gZnVsbFNwYW4gLyBzaXplOwogICAgICAgIGNvbnN0IHNwYW4gPSBmdWxsU3BhbiAvIDI7CiAgICAgICAgY29uc3QgYWxwaGFNID0gTWF0aC5QSSAvIDI7CiAgICAgICAgY29uc3QgYW5pbWF0aW9uU3RlcHMgPSAxMDsKICAgICAgICBjb25zdCBhbmltYXRpb25Db25maWcgPSB7CiAgICAgICAgICAgIHN0ZXBzOiBhbmltYXRpb25TdGVwcywKICAgICAgICAgICAgZEFscGhhOiBhbHBoYU0gLyBhbmltYXRpb25TdGVwcwogICAgICAgIH07CiAgICAgICAgY29uc3QgZ3JpZCA9IHt9OwogICAgICAgIGNvbnN0IGZhY2VzID0gW107CiAgICAgICAgY29uc3QgZmFjZUNvbmZpZyA9IFsKICAgICAgICAgICAgeyAnZml4ZWQnOiAneCcsICdkaXJlY3Rpb24nOiAtMSwgJ3ZhcmlhYmxlJzogWyd5JywgJ3onXSwgJ2NvbG9yJzogJ3llbGxvdycgfSwKICAgICAgICAgICAgeyAnZml4ZWQnOiAneCcsICdkaXJlY3Rpb24nOiAxLCAndmFyaWFibGUnOiBbJ3knLCAneiddLCAnY29sb3InOiAnd2hpdGUnIH0sCiAgICAgICAgICAgIHsgJ2ZpeGVkJzogJ3knLCAnZGlyZWN0aW9uJzogLTEsICd2YXJpYWJsZSc6IFsneicsICd4J10sICdjb2xvcic6ICdibHVlJyB9LAogICAgICAgICAgICB7ICdmaXhlZCc6ICd5JywgJ2RpcmVjdGlvbic6IDEsICd2YXJpYWJsZSc6IFsneicsICd4J10sICdjb2xvcic6ICdsYXduZ3JlZW4nIH0sCiAgICAgICAgICAgIHsgJ2ZpeGVkJzogJ3onLCAnZGlyZWN0aW9uJzogLTEsICd2YXJpYWJsZSc6IFsneCcsICd5J10sICdjb2xvcic6ICdyZWQnIH0sCiAgICAgICAgICAgIHsgJ2ZpeGVkJzogJ3onLCAnZGlyZWN0aW9uJzogMSwgJ3ZhcmlhYmxlJzogWyd4JywgJ3knXSwgJ2NvbG9yJzogJ2RhcmtvcmFuZ2UnIH0sCiAgICAgICAgXTsKICAgICAgICBjb25zdCBjeWNsZUZhbWlseUNvbmZpZyA9IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJ3NsaWNlcyc6IFsKICAgICAgICAgICAgICAgICAgICB7IGZJbmRleDogMSwgc0luZGV4OiAwLCBzSnVtcDogc2l6ZSwgY0p1bXA6IDEgfSwKICAgICAgICAgICAgICAgICAgICB7IGZJbmRleDogMywgc0luZGV4OiBzaXplIC0gMSwgc0p1bXA6IC0xLCBjSnVtcDogc2l6ZSB9LAogICAgICAgICAgICAgICAgICAgIHsgZkluZGV4OiAwLCBzSW5kZXg6IChzaXplIC0gMSkgKiBzaXplLCBzSnVtcDogLXNpemUsIGNKdW1wOiAxIH0sCiAgICAgICAgICAgICAgICAgICAgeyBmSW5kZXg6IDIsIHNJbmRleDogMCwgc0p1bXA6IDEsIGNKdW1wOiBzaXplIH0KICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAnYXR0YWNoZWRGYWNlcyc6IHsgZmZJbmRleDogNCwgbGZJbmRleDogNSwgaVN0ZXA6IHNpemUsIGpTdGVwOiAxIH0sCiAgICAgICAgICAgICAgICAndW5pdFZlY3Rvcic6IG5ldyBWZWN0b3IobmV3IFBvaW50KDAsIDAsIDEpKQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAnc2xpY2VzJzogWwogICAgICAgICAgICAgICAgICAgIHsgZkluZGV4OiAxLCBzSW5kZXg6IDAsIHNKdW1wOiAxLCBjSnVtcDogc2l6ZSB9LAogICAgICAgICAgICAgICAgICAgIHsgZkluZGV4OiA1LCBzSW5kZXg6IChzaXplIC0gMSkgKiBzaXplLCBzSnVtcDogLXNpemUsIGNKdW1wOiAxIH0sCiAgICAgICAgICAgICAgICAgICAgeyBmSW5kZXg6IDAsIHNJbmRleDogc2l6ZSAtIDEsIHNKdW1wOiAtMSwgY0p1bXA6IHNpemUgfSwKICAgICAgICAgICAgICAgICAgICB7IGZJbmRleDogNCwgc0luZGV4OiAwLCBzSnVtcDogc2l6ZSwgY0p1bXA6IDEgfQogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICdhdHRhY2hlZEZhY2VzJzogeyBmZkluZGV4OiAyLCBsZkluZGV4OiAzLCBpU3RlcDogMSwgalN0ZXA6IHNpemUgfSwKICAgICAgICAgICAgICAgICd1bml0VmVjdG9yJzogbmV3IFZlY3RvcihuZXcgUG9pbnQoMCwgLTEsIDApKQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAnc2xpY2VzJzogWwogICAgICAgICAgICAgICAgICAgIHsgZkluZGV4OiAyLCBzSW5kZXg6IDAsIHNKdW1wOiBzaXplLCBjSnVtcDogMSB9LAogICAgICAgICAgICAgICAgICAgIHsgZkluZGV4OiA1LCBzSW5kZXg6IDAsIHNKdW1wOiAxLCBjSnVtcDogc2l6ZSB9LAogICAgICAgICAgICAgICAgICAgIHsgZkluZGV4OiAzLCBzSW5kZXg6IChzaXplIC0gMSkgKiBzaXplLCBzSnVtcDogLXNpemUsIGNKdW1wOiAxIH0sCiAgICAgICAgICAgICAgICAgICAgeyBmSW5kZXg6IDQsIHNJbmRleDogc2l6ZSAtIDEsIHNKdW1wOiAtMSwgY0p1bXA6IHNpemUgfQogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICdhdHRhY2hlZEZhY2VzJzogeyBmZkluZGV4OiAwLCBsZkluZGV4OiAxLCBpU3RlcDogMSwgalN0ZXA6IHNpemUgfSwKICAgICAgICAgICAgICAgICd1bml0VmVjdG9yJzogbmV3IFZlY3RvcihuZXcgUG9pbnQoLTEsIDAsIDApKQogICAgICAgICAgICB9CiAgICAgICAgXTsKICAgICAgICBjb25zdCBmU2xpY2VDb25maWcgPSBbeyBrZXk6ICdpU3RlcCcsIGRpcjogMSB9LCB7IGtleTogJ2pTdGVwJywgZGlyOiAxIH0sIHsga2V5OiAnaVN0ZXAnLCBkaXI6IC0xIH0sIHsga2V5OiAnalN0ZXAnLCBkaXI6IC0xIH1dOwoKICAgICAgICBsZXQgdjEsIHYyLCBwb2ludERlZiwgcGlkLCBzaWQsIHNwb2ludHM7CiAgICAgICAgZmFjZUNvbmZpZy5mb3JFYWNoKChjb25maWcsIGYpID0+IHsKICAgICAgICAgICAgbGV0IHN0aWNrZXJzID0gW107CiAgICAgICAgICAgIHYxID0gLXNwYW47CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IHNpemU7IGkrKykgewogICAgICAgICAgICAgICAgdjIgPSAtc3BhbjsKICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDw9IHNpemU7IGorKykgewogICAgICAgICAgICAgICAgICAgIHBpZCA9IGBwLSR7Zn0tJHtpfS0ke2p9YDsKICAgICAgICAgICAgICAgICAgICBwb2ludERlZiA9IHt9OwogICAgICAgICAgICAgICAgICAgIHBvaW50RGVmW2NvbmZpZy5maXhlZF0gPSBjb25maWcuZGlyZWN0aW9uICogc3BhbjsKICAgICAgICAgICAgICAgICAgICBwb2ludERlZltjb25maWcudmFyaWFibGVbMF1dID0gdjE7CiAgICAgICAgICAgICAgICAgICAgcG9pbnREZWZbY29uZmlnLnZhcmlhYmxlWzFdXSA9IHYyOwogICAgICAgICAgICAgICAgICAgIGdyaWRbcGlkXSA9IG5ldyBQb2ludChwb2ludERlZi54LCBwb2ludERlZi55LCBwb2ludERlZi56LCBwaWQpOwogICAgICAgICAgICAgICAgICAgIGlmIChpICYmIGopIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2lkID0gYHMtJHtmfS0ke2l9LSR7an1gOwogICAgICAgICAgICAgICAgICAgICAgICBzcG9pbnRzID0gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZFtgcC0ke2Z9LSR7aX0tJHtqfWBdLmNsb25lKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmlkW2BwLSR7Zn0tJHtpIC0gMX0tJHtqfWBdLmNsb25lKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmlkW2BwLSR7Zn0tJHtpIC0gMX0tJHtqIC0gMX1gXS5jbG9uZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZFtgcC0ke2Z9LSR7aX0tJHtqIC0gMX1gXS5jbG9uZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25maWcuZGlyZWN0aW9uID09PSAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BvaW50cy5yZXZlcnNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgc3RpY2tlcnMucHVzaChuZXcgU3RpY2tlcihzaWQsIGNvbmZpZy5jb2xvciwgc3BvaW50cykpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHYyICs9IHdpZHRoOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdjEgKz0gd2lkdGg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZmFjZXMucHVzaChuZXcgRmFjZShzdGlja2VycykpOwogICAgICAgIH0pOwoKICAgICAgICBjb25zdCBjeWNsZXMgPSBbXTsKICAgICAgICBsZXQgY3ljbGUsIHN0aWNrZXJDb2xsZWN0aW9uLCBzdGlja2VySW5kZXgsIGZDeWNsZSwgbEN5Y2xlLCBmRmFjZSwgbEZhY2U7CiAgICAgICAgY3ljbGVGYW1pbHlDb25maWcuZm9yRWFjaChjb25maWcgPT4gewogICAgICAgICAgICBmb3IgKGxldCBjID0gMDsgYyA8IHNpemU7IGMrKykgewogICAgICAgICAgICAgICAgY3ljbGUgPSBuZXcgQ3ljbGUoW10sIDQsIGNvbmZpZy51bml0VmVjdG9yLCBhbmltYXRpb25Db25maWcpOwogICAgICAgICAgICAgICAgc3RpY2tlckNvbGxlY3Rpb24gPSBbXTsKICAgICAgICAgICAgICAgIGNvbmZpZy5zbGljZXMuZm9yRWFjaChzbGljZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgcyA9IDA7IHMgPCBzaXplOyBzKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RpY2tlckluZGV4ID0gc2xpY2Uuc0luZGV4ICsgcyAqIHNsaWNlLnNKdW1wICsgYyAqIHNsaWNlLmNKdW1wOwogICAgICAgICAgICAgICAgICAgICAgICBzdGlja2VyQ29sbGVjdGlvbi5wdXNoKGZhY2VzW3NsaWNlLmZJbmRleF0uc3RpY2tlcnNbc3RpY2tlckluZGV4XSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBjeWNsZS5zdGlja2VyQ29sbGVjdGlvbnMucHVzaChzdGlja2VyQ29sbGVjdGlvbik7CiAgICAgICAgICAgICAgICBjeWNsZXMucHVzaChjeWNsZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZkN5Y2xlID0gY3ljbGVzW2N5Y2xlcy5sZW5ndGggLSBzaXplXTsKICAgICAgICAgICAgZkZhY2UgPSBmYWNlc1tjb25maWcuYXR0YWNoZWRGYWNlcy5mZkluZGV4XTsKICAgICAgICAgICAgZm9yIChsZXQgYyA9IDA7IGMgPCBNYXRoLmZsb29yKHNpemUgLyAyKTsgYysrKSB7CiAgICAgICAgICAgICAgICBzdGlja2VyQ29sbGVjdGlvbiA9IFtdOwogICAgICAgICAgICAgICAgc3RpY2tlckluZGV4ID0gYyAqIChzaXplICsgMSk7CiAgICAgICAgICAgICAgICBmU2xpY2VDb25maWcuZm9yRWFjaCgoeyBrZXksIGRpciB9KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgcyA9IDA7IHMgPCBzaXplIC0gMiAqIGMgLSAxOyBzKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RpY2tlckNvbGxlY3Rpb24ucHVzaChmRmFjZS5zdGlja2Vyc1tzdGlja2VySW5kZXhdKTsKICAgICAgICAgICAgICAgICAgICAgICAgc3RpY2tlckluZGV4ICs9IGNvbmZpZy5hdHRhY2hlZEZhY2VzW2tleV0gKiBkaXI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBmQ3ljbGUuc3RpY2tlckNvbGxlY3Rpb25zLnB1c2goc3RpY2tlckNvbGxlY3Rpb24pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxDeWNsZSA9IGN5Y2xlc1tjeWNsZXMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgIGxGYWNlID0gZmFjZXNbY29uZmlnLmF0dGFjaGVkRmFjZXMubGZJbmRleF07CiAgICAgICAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgTWF0aC5mbG9vcihzaXplIC8gMik7IGMrKykgewogICAgICAgICAgICAgICAgc3RpY2tlckNvbGxlY3Rpb24gPSBbXTsKICAgICAgICAgICAgICAgIHN0aWNrZXJJbmRleCA9IGMgKiAoc2l6ZSArIDEpOwogICAgICAgICAgICAgICAgZlNsaWNlQ29uZmlnLmZvckVhY2goKHsga2V5LCBkaXIgfSkgPT4gewogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHMgPSAwOyBzIDwgc2l6ZSAtIDIgKiBjIC0gMTsgcysrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0aWNrZXJDb2xsZWN0aW9uLnB1c2gobEZhY2Uuc3RpY2tlcnNbc3RpY2tlckluZGV4XSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0aWNrZXJJbmRleCArPSBjb25maWcuYXR0YWNoZWRGYWNlc1trZXldICogZGlyOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgbEN5Y2xlLnN0aWNrZXJDb2xsZWN0aW9ucy5wdXNoKHN0aWNrZXJDb2xsZWN0aW9uKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc2l6ZSAlIDIpIHsKICAgICAgICAgICAgICAgIGZDeWNsZS5zdGlja2VyQ29sbGVjdGlvbnMucHVzaChbZkZhY2Uuc3RpY2tlcnNbKHNpemUgKiBzaXplIC0gMSkgLyAyXV0pOwogICAgICAgICAgICAgICAgbEN5Y2xlLnN0aWNrZXJDb2xsZWN0aW9ucy5wdXNoKFtsRmFjZS5zdGlja2Vyc1soc2l6ZSAqIHNpemUgLSAxKSAvIDJdXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBjeWNsZXMuZm9yRWFjaChjeWNsZSA9PiB7CiAgICAgICAgICAgIGN5Y2xlLnN0aWNrZXJDb2xsZWN0aW9uc1swXS5pc1ByaW1hcnkgPSB0cnVlOwogICAgICAgICAgICBjeWNsZS5jb21wdXRlU3RpY2tlckNvdmVyKCkKICAgICAgICB9KTsKICAgICAgICBzdXBlcihmYWNlcywgY3ljbGVzKTsKCiAgICAgICAgdGhpcy5zYXZlT3JpZW50YXRpb24oewogICAgICAgICAgICAnYXhpcyc6IG5ldyBWZWN0b3IoeyB4OiAwLCB5OiAxLCB6OiAwfSksCiAgICAgICAgICAgICdhbmdsZSc6IE1hdGguUEkgLyA0CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5zYXZlT3JpZW50YXRpb24oewogICAgICAgICAgICAnYXhpcyc6IG5ldyBWZWN0b3IoeyB4OiAxLCB5OiAwLCB6OiAwfSksCiAgICAgICAgICAgICdhbmdsZSc6IE1hdGguUEkgLyA4CiAgICAgICAgfSk7CiAgICB9Cn0KCjwvc2NyaXB0PgogICAgPHNjcmlwdCB0eXBlPSJhcHBsaWNhdGlvbi9qYXZhc2NyaXB0Ij4vLyBEZWZpbml0aW9uIG9mIHRldHJhaGVkcm9uIHNoYXBlZCBwdXp6bGVzCi8vIEdyaWQgOiBzdXJmYWNlIG9mIHRoZSByZWd1bGFyIHRldHJhaGVkcm9uCi8vIEZhY2VzIDogNCBlcXVpbGF0ZXJhbCB0cmlhbmdsZXMKLy8gQ3ljbGVzIDogKDQgKiBzaXplKSBudW1iZXIgb2YgY3ljbGVzIGNvbnNpc3Rpbmcgb2YgMSBzdWIgY3ljbGUgZm9yIHRoZSBzbGljZSAmIHBvc3NpYmx5IG90aGVycyBmb3IgYXR0YWNoZWQgZmFjZQpjbGFzcyBUZXRyYWhlZHJvbiBleHRlbmRzIFB1enpsZSB7CiAgICBjb25zdHJ1Y3RvcihzaXplID0gMywgZnVsbFNwYW4gPSAyMDApIHsKICAgICAgICBjb25zdCBhbHRpdHVkZSA9IGZ1bGxTcGFuIC8gTWF0aC5zcXJ0KDIpOwogICAgICAgIGNvbnN0IGFscGhhTSA9IDIgKiBNYXRoLlBJIC8gMzsKICAgICAgICBjb25zdCBhbmltYXRpb25TdGVwcyA9IDEwOwogICAgICAgIGNvbnN0IGFuaW1hdGlvbkNvbmZpZyA9IHsKICAgICAgICAgICAgc3RlcHM6IGFuaW1hdGlvblN0ZXBzLAogICAgICAgICAgICBkQWxwaGE6IGFscGhhTSAvIGFuaW1hdGlvblN0ZXBzCiAgICAgICAgfTsKICAgICAgICBjb25zdCBncmlkID0ge307CiAgICAgICAgY29uc3Qgc3RpY2tlck1hcCA9IHt9OwogICAgICAgIGNvbnN0IGZhY2VzID0gW107CiAgICAgICAgY29uc3QgY3ljbGVzID0gW107CiAgICAgICAgY29uc3Qgcm9vdFBvaW50cyA9IFsKICAgICAgICAgICAgbmV3IFBvaW50KGZ1bGxTcGFuLCAwLCBhbHRpdHVkZSksCiAgICAgICAgICAgIG5ldyBQb2ludCgtZnVsbFNwYW4sIDAsIGFsdGl0dWRlKSwKICAgICAgICAgICAgbmV3IFBvaW50KDAsIGZ1bGxTcGFuLCAtYWx0aXR1ZGUpLAogICAgICAgICAgICBuZXcgUG9pbnQoMCwgLWZ1bGxTcGFuLCAtYWx0aXR1ZGUpCiAgICAgICAgXTsKICAgICAgICBjb25zdCBmYWNlQ29uZmlnID0gWwogICAgICAgICAgICB7ICdwb2ludHMnOiBbcm9vdFBvaW50c1swXSwgcm9vdFBvaW50c1syXSwgcm9vdFBvaW50c1sxXV0sICdjb2xvcic6ICd3aGl0ZScgfSwKICAgICAgICAgICAgeyAncG9pbnRzJzogW3Jvb3RQb2ludHNbMF0sIHJvb3RQb2ludHNbMV0sIHJvb3RQb2ludHNbM11dLCAnY29sb3InOiAnYmx1ZScgfSwKICAgICAgICAgICAgeyAncG9pbnRzJzogW3Jvb3RQb2ludHNbMF0sIHJvb3RQb2ludHNbM10sIHJvb3RQb2ludHNbMl1dLCAnY29sb3InOiAnbGF3bmdyZWVuJyB9LAogICAgICAgICAgICB7ICdwb2ludHMnOiBbcm9vdFBvaW50c1sxXSwgcm9vdFBvaW50c1syXSwgcm9vdFBvaW50c1szXV0sICdjb2xvcic6ICdyZWQnIH0KICAgICAgICBdOwogICAgICAgIGNvbnN0IGN5Y2xlRmFtaWx5Q29uZmlnID0gWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAnc2xpY2VzJzogWwogICAgICAgICAgICAgICAgICAgIHsgZkluZGV4OiAwLCBzSUo6IHJvdyA9PiBbcm93LCAwXSwgZElKOiAoKSA9PiBbMCwgMV0gfSwKICAgICAgICAgICAgICAgICAgICB7IGZJbmRleDogMSwgc0lKOiByb3cgPT4gW3JvdywgMF0sIGRJSjogKCkgPT4gWzAsIDFdIH0sCiAgICAgICAgICAgICAgICAgICAgeyBmSW5kZXg6IDIsIHNJSjogcm93ID0+IFtyb3csIDBdLCBkSUo6ICgpID0+IFswLCAxXSB9CiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgJ2F0dGFjaGVkRmFjZSc6IHsgZkluZGV4OiAzLCBzdGVwczogWygpID0+IFsxLCAyXSwgKCkgPT4gWzAsIC0yXSwgKCkgPT4gWy0xLCAwXV0gfSwKICAgICAgICAgICAgICAgICd1bml0VmVjdG9yJzogbmV3IFZlY3Rvcihyb290UG9pbnRzWzBdKS51bml0KCkKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgJ3NsaWNlcyc6IFsKICAgICAgICAgICAgICAgICAgICB7IGZJbmRleDogMCwgc0lKOiByb3cgPT4gW3NpemUgLSByb3cgLSAxLCAyICogKHNpemUgLSByb3cgLSAxKV0sIGRJSjogKF9yb3csIGNvbCkgPT4gW2NvbCAlIDIgPyAwIDogMSwgY29sICUgMiA/IC0xIDogMV0gfSwKICAgICAgICAgICAgICAgICAgICB7IGZJbmRleDogMywgc0lKOiByb3cgPT4gW3JvdywgMF0sIGRJSjogKCkgPT4gWzAsIDFdIH0sCiAgICAgICAgICAgICAgICAgICAgeyBmSW5kZXg6IDEsIHNJSjogcm93ID0+IFtzaXplIC0gMSwgMiAqIHJvd10sIGRJSjogKF9yb3csIGNvbCkgPT4gW2NvbCAlIDIgPyAtMSA6IDAsIC0xXSB9CiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgJ2F0dGFjaGVkRmFjZSc6IHsgZkluZGV4OiAyLCBzdGVwczogWygpID0+IFsxLCAyXSwgKCkgPT4gWzAsIC0yXSwgKCkgPT4gWy0xLCAwXV0gfSwKICAgICAgICAgICAgICAgICd1bml0VmVjdG9yJzogbmV3IFZlY3Rvcihyb290UG9pbnRzWzFdKS51bml0KCkKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgJ3NsaWNlcyc6IFsKICAgICAgICAgICAgICAgICAgICB7IGZJbmRleDogMCwgc0lKOiByb3cgPT4gW3NpemUgLSAxLCAyICogcm93XSwgZElKOiAoX3JvdywgY29sKSA9PiBbY29sICUgMiA/IC0xIDogMCwgLTFdIH0sCiAgICAgICAgICAgICAgICAgICAgeyBmSW5kZXg6IDIsIHNJSjogcm93ID0+IFtzaXplIC0gcm93IC0gMSwgMiAqIChzaXplIC0gcm93IC0gMSldLCBkSUo6IChfcm93LCBjb2wpID0+IFtjb2wgJSAyID8gMCA6IDEsIGNvbCAlIDIgPyAtMSA6IDFdIH0sCiAgICAgICAgICAgICAgICAgICAgeyBmSW5kZXg6IDMsIHNJSjogcm93ID0+IFtzaXplIC0gMSwgMiAqIHJvd10sIGRJSjogKF9yb3csIGNvbCkgPT4gW2NvbCAlIDIgPyAtMSA6IDAsIC0xXSB9CiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgJ2F0dGFjaGVkRmFjZSc6IHsgZkluZGV4OiAxLCBzdGVwczogWygpID0+IFsxLCAyXSwgKCkgPT4gWzAsIC0yXSwgKCkgPT4gWy0xLCAwXV0gfSwKICAgICAgICAgICAgICAgICd1bml0VmVjdG9yJzogbmV3IFZlY3Rvcihyb290UG9pbnRzWzJdKS51bml0KCkKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgJ3NsaWNlcyc6IFsKICAgICAgICAgICAgICAgICAgICB7IGZJbmRleDogMSwgc0lKOiByb3cgPT4gW3NpemUgLSByb3cgLSAxLCAyICogKHNpemUgLSByb3cgLSAxKV0sIGRJSjogKF9yb3csIGNvbCkgPT4gW2NvbCAlIDIgPyAwIDogMSwgY29sICUgMiA/IC0xIDogMV0gfSwKICAgICAgICAgICAgICAgICAgICB7IGZJbmRleDogMywgc0lKOiByb3cgPT4gW3NpemUgLSByb3cgLSAxLCAyICogKHNpemUgLSByb3cgLSAxKV0sIGRJSjogKF9yb3csIGNvbCkgPT4gW2NvbCAlIDIgPyAwIDogMSwgY29sICUgMiA/IC0xIDogMV0gfSwKICAgICAgICAgICAgICAgICAgICB7IGZJbmRleDogMiwgc0lKOiByb3cgPT4gW3NpemUgLSAxLCAyICogcm93XSwgZElKOiAoX3JvdywgY29sKSA9PiBbY29sICUgMiA/IC0xIDogMCwgLTFdIH0KICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAnYXR0YWNoZWRGYWNlJzogeyBmSW5kZXg6IDAsIHN0ZXBzOiBbKCkgPT4gWzEsIDJdLCAoKSA9PiBbMCwgLTJdLCAoKSA9PiBbLTEsIDBdXSB9LAogICAgICAgICAgICAgICAgJ3VuaXRWZWN0b3InOiBuZXcgVmVjdG9yKHJvb3RQb2ludHNbM10pLnVuaXQoKQogICAgICAgICAgICB9CiAgICAgICAgXQogICAgICAgIGZhY2VDb25maWcuZm9yRWFjaCgoY29uZmlnLCBmKSA9PiB7CiAgICAgICAgICAgIGxldCBzdGlja2VycyA9IFtdOwogICAgICAgICAgICBsZXQgcHJlQXJyID0gW2NvbmZpZy5wb2ludHNbMF0uY2xvbmUoKV0sIG54dEFyciwgcCwgcSwgciwgczsKICAgICAgICAgICAgbGV0IHZJID0gbmV3IFZlY3Rvcihjb25maWcucG9pbnRzWzBdLCBjb25maWcucG9pbnRzWzFdKS5tdWx0aXBseSgxIC8gc2l6ZSk7CiAgICAgICAgICAgIGxldCB2SiA9IG5ldyBWZWN0b3IoY29uZmlnLnBvaW50c1sxXSwgY29uZmlnLnBvaW50c1syXSkubXVsdGlwbHkoMSAvIHNpemUpOwogICAgICAgICAgICBsZXQgdkM7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2l6ZTsgaSsrKSB7CiAgICAgICAgICAgICAgICBueHRBcnIgPSBbXTsKICAgICAgICAgICAgICAgIHZDID0gdkkuYWRkKHByZUFyclswXSk7CiAgICAgICAgICAgICAgICBueHRBcnIucHVzaChuZXcgUG9pbnQodkMueCwgdkMueSwgdkMueikpOwogICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPD0gaTsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgdkMgPSB2Si5hZGQodkMpOwogICAgICAgICAgICAgICAgICAgIG54dEFyci5wdXNoKG5ldyBQb2ludCh2Qy54LCB2Qy55LCB2Qy56KSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBwcmVBcnIuZm9yRWFjaCgocG9pbnQsIGopID0+IHsKICAgICAgICAgICAgICAgICAgICBwID0gcG9pbnQuY2xvbmUoKTsKICAgICAgICAgICAgICAgICAgICBxID0gbnh0QXJyW2pdLmNsb25lKCk7CiAgICAgICAgICAgICAgICAgICAgciA9IG54dEFycltqICsgMV0uY2xvbmUoKTsKICAgICAgICAgICAgICAgICAgICBwLmlkID0gYHAtJHtmfS0ke2l9LSR7an1gOwogICAgICAgICAgICAgICAgICAgIHEuaWQgPSBgcC0ke2Z9LSR7aSArIDF9LSR7an1gOwogICAgICAgICAgICAgICAgICAgIHIuaWQgPSBgcC0ke2Z9LSR7aSArIDF9LSR7aiArIDF9YDsKICAgICAgICAgICAgICAgICAgICBncmlkW3AuaWRdID0gcC5jbG9uZSgpOwogICAgICAgICAgICAgICAgICAgIGdyaWRbcS5pZF0gPSBxLmNsb25lKCk7CiAgICAgICAgICAgICAgICAgICAgZ3JpZFtyLmlkXSA9IHIuY2xvbmUoKTsKICAgICAgICAgICAgICAgICAgICBzdGlja2Vycy5wdXNoKG5ldyBTdGlja2VyKGBzLSR7Zn0tJHtpfS0kezIgKiBqfWAsIGNvbmZpZy5jb2xvciwgW3AsIHEsIHJdKSk7CiAgICAgICAgICAgICAgICAgICAgc3RpY2tlck1hcFtzdGlja2Vyc1tzdGlja2Vycy5sZW5ndGggLSAxXS5pZF0gPSBzdGlja2Vyc1tzdGlja2Vycy5sZW5ndGggLSAxXTsKICAgICAgICAgICAgICAgICAgICBpZiAoaiA8IHByZUFyci5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHAgPSBwLmNsb25lKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHIgPSByLmNsb25lKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHMgPSBwcmVBcnJbaiArIDFdLmNsb25lKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHMuaWQgPSBgcS0ke2Z9LSR7aX0tJHtqICsgMX1gOwogICAgICAgICAgICAgICAgICAgICAgICBncmlkW3AuaWRdID0gcC5jbG9uZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBncmlkW3IuaWRdID0gci5jbG9uZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBncmlkW3MuaWRdID0gcy5jbG9uZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBzdGlja2Vycy5wdXNoKG5ldyBTdGlja2VyKGBzLSR7Zn0tJHtpfS0kezIgKiBqICsgMX1gLCBjb25maWcuY29sb3IsIFtwLCByLCBzXSkpOwogICAgICAgICAgICAgICAgICAgICAgICBzdGlja2VyTWFwW3N0aWNrZXJzW3N0aWNrZXJzLmxlbmd0aCAtIDFdLmlkXSA9IHN0aWNrZXJzW3N0aWNrZXJzLmxlbmd0aCAtIDFdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcHJlQXJyID0gbnh0QXJyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZhY2VzLnB1c2gobmV3IEZhY2Uoc3RpY2tlcnMpKTsKICAgICAgICB9KTsKICAgICAgICBsZXQgY3ljbGUsIGFGYWNlLCBzdGlja2VyQ29sbGVjdGlvbiwgc0ksIHNKLCBkSSwgZEo7CiAgICAgICAgY3ljbGVGYW1pbHlDb25maWcuZm9yRWFjaChjb25maWcgPT4gewogICAgICAgICAgICBmb3IgKGxldCBjID0gMDsgYyA8IHNpemU7IGMrKykgewogICAgICAgICAgICAgICAgY3ljbGUgPSBuZXcgQ3ljbGUoW10sIDMsIGNvbmZpZy51bml0VmVjdG9yLCBhbmltYXRpb25Db25maWcpOwogICAgICAgICAgICAgICAgc3RpY2tlckNvbGxlY3Rpb24gPSBbXTsKICAgICAgICAgICAgICAgIGNvbmZpZy5zbGljZXMuZm9yRWFjaChzbGljZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgW3NJLCBzSl0gPSBzbGljZS5zSUooYyk7CiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgcyA9IDA7IHMgPCAxICsgKDIgKiBjKTsgcysrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFtkSSwgZEpdID0gc2xpY2UuZElKKGMsIHMpOwogICAgICAgICAgICAgICAgICAgICAgICBzdGlja2VyQ29sbGVjdGlvbi5wdXNoKHN0aWNrZXJNYXBbYHMtJHtzbGljZS5mSW5kZXh9LSR7c0l9LSR7c0p9YF0pOwogICAgICAgICAgICAgICAgICAgICAgICBzSSArPSBkSTsKICAgICAgICAgICAgICAgICAgICAgICAgc0ogKz0gZEo7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBjeWNsZS5zdGlja2VyQ29sbGVjdGlvbnMucHVzaChzdGlja2VyQ29sbGVjdGlvbik7CiAgICAgICAgICAgICAgICBjeWNsZXMucHVzaChjeWNsZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY3ljbGUgPSBjeWNsZXNbY3ljbGVzLmxlbmd0aCAtIDFdOwogICAgICAgICAgICBhRmFjZSA9IGNvbmZpZy5hdHRhY2hlZEZhY2UuZkluZGV4OwogICAgICAgICAgICBsZXQgbCA9IHNpemUgLSAxOwogICAgICAgICAgICBsZXQgZCA9IDE7CiAgICAgICAgICAgIGxldCBzID0gMCwgdCwgaSwgajsKICAgICAgICAgICAgd2hpbGUgKGwgPiAwKSB7CiAgICAgICAgICAgICAgICBpID0gaiA9IHM7CiAgICAgICAgICAgICAgICBzdGlja2VyQ29sbGVjdGlvbiA9IFtdOwogICAgICAgICAgICAgICAgY29uZmlnLmF0dGFjaGVkRmFjZS5zdGVwcy5mb3JFYWNoKHN0ZXBDb25maWdHZXR0ZXIgPT4gewogICAgICAgICAgICAgICAgICAgIHQgPSAwOwogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgbDsgeCsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBbc3RlcEksIHN0ZXBKXSA9IHN0ZXBDb25maWdHZXR0ZXIocywgdCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0aWNrZXJDb2xsZWN0aW9uLnB1c2goc3RpY2tlck1hcFtgcy0ke2FGYWNlfS0ke2l9LSR7an1gXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGkgKz0gc3RlcEk7CiAgICAgICAgICAgICAgICAgICAgICAgIGogKz0gc3RlcEo7CiAgICAgICAgICAgICAgICAgICAgICAgIHQgKz0gMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGN5Y2xlLnN0aWNrZXJDb2xsZWN0aW9ucy5wdXNoKHN0aWNrZXJDb2xsZWN0aW9uKTsKICAgICAgICAgICAgICAgIHMgKz0gMTsKICAgICAgICAgICAgICAgIGwgLT0gZDsKICAgICAgICAgICAgICAgIGQgPSBkID09PSAyID8gMSA6IDI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHN0aWNrZXJNYXBbYHMtJHthRmFjZX0tJHtzfS0ke3N9YF0pIHsKICAgICAgICAgICAgICAgIGN5Y2xlLnN0aWNrZXJDb2xsZWN0aW9ucy5wdXNoKFtzdGlja2VyTWFwW2BzLSR7YUZhY2V9LSR7c30tJHtzfWBdXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBjeWNsZXMuZm9yRWFjaChjeWNsZSA9PiB7CiAgICAgICAgICAgIGN5Y2xlLnN0aWNrZXJDb2xsZWN0aW9uc1swXS5pc1ByaW1hcnkgPSB0cnVlOwogICAgICAgICAgICBjeWNsZS5jb21wdXRlU3RpY2tlckNvdmVyKCkKICAgICAgICB9KTsKICAgICAgICBzdXBlcihmYWNlcywgY3ljbGVzKTsKCiAgICAgICAgdGhpcy5zYXZlT3JpZW50YXRpb24oewogICAgICAgICAgICAnYXhpcyc6IG5ldyBWZWN0b3IoeyB4OiAwLCB5OiAxLCB6OiAwfSksCiAgICAgICAgICAgICdhbmdsZSc6IE1hdGguUEkgLyAzCiAgICAgICAgfSk7CiAgICB9Cn0KCjwvc2NyaXB0PgogICAgPHNjcmlwdCB0eXBlPSJhcHBsaWNhdGlvbi9qYXZhc2NyaXB0Ij4vLyBEZWZpbml0aW9uIG9mIG9jdGFoZWRyb24gc2hhcGVkIHB1enpsZXMKLy8gR3JpZCA6IHN1cmZhY2Ugb2YgdGhlIHJlZ3VsYXIgb2N0YWhlZHJvbgovLyBGYWNlcyA6IDggZXF1aWxhdGVyYWwgdHJpYW5nbGVzCi8vIEN5Y2xlcyA6ICg0ICogc2l6ZSkgbnVtYmVyIG9mIGN5Y2xlcyBjb25zaXN0aW5nIG9mIDEgc3ViIGN5Y2xlIGZvciB0aGUgc2xpY2UgJiBwb3NzaWJseSBvdGhlcnMgZm9yIGF0dGFjaGVkIGZhY2UKY2xhc3MgT2N0YWhlZHJvbiBleHRlbmRzIFB1enpsZSB7CiAgICBjb25zdHJ1Y3RvcihzaXplID0gMiwgZnVsbFNwYW4gPSAyMDApIHsKICAgICAgICBjb25zdCBhbHBoYU0gPSAyICogTWF0aC5QSSAvIDM7CiAgICAgICAgY29uc3QgYW5pbWF0aW9uU3RlcHMgPSAxMDsKICAgICAgICBjb25zdCBhbmltYXRpb25Db25maWcgPSB7CiAgICAgICAgICAgIHN0ZXBzOiBhbmltYXRpb25TdGVwcywKICAgICAgICAgICAgZEFscGhhOiBhbHBoYU0gLyBhbmltYXRpb25TdGVwcwogICAgICAgIH07CiAgICAgICAgY29uc3QgZ3JpZCA9IHt9OwogICAgICAgIGNvbnN0IHN0aWNrZXJNYXAgPSB7fTsKICAgICAgICBjb25zdCBmYWNlcyA9IFtdOwogICAgICAgIGNvbnN0IGN5Y2xlcyA9IFtdOwogICAgICAgIGNvbnN0IHJvb3RQb2ludHMgPSBbCiAgICAgICAgICAgIG5ldyBQb2ludCgwLCAwLCAtZnVsbFNwYW4pLAogICAgICAgICAgICBuZXcgUG9pbnQoZnVsbFNwYW4sIDAsIDApLAogICAgICAgICAgICBuZXcgUG9pbnQoMCwgZnVsbFNwYW4sIDApLAogICAgICAgICAgICBuZXcgUG9pbnQoLWZ1bGxTcGFuLCAwLCAwKSwKICAgICAgICAgICAgbmV3IFBvaW50KDAsIC1mdWxsU3BhbiwgMCksCiAgICAgICAgICAgIG5ldyBQb2ludCgwLCAwLCBmdWxsU3BhbikKICAgICAgICBdOwogICAgICAgIGNvbnN0IGZhY2VDb25maWcgPSBbCiAgICAgICAgICAgIHsgJ3BvaW50cyc6IFtyb290UG9pbnRzWzBdLCByb290UG9pbnRzWzJdLCByb290UG9pbnRzWzFdXSwgJ2NvbG9yJzogJ3doaXRlJyB9LAogICAgICAgICAgICB7ICdwb2ludHMnOiBbcm9vdFBvaW50c1swXSwgcm9vdFBvaW50c1sxXSwgcm9vdFBvaW50c1s0XV0sICdjb2xvcic6ICdibHVlJyB9LAogICAgICAgICAgICB7ICdwb2ludHMnOiBbcm9vdFBvaW50c1swXSwgcm9vdFBvaW50c1s0XSwgcm9vdFBvaW50c1szXV0sICdjb2xvcic6ICdsYXduZ3JlZW4nIH0sCiAgICAgICAgICAgIHsgJ3BvaW50cyc6IFtyb290UG9pbnRzWzBdLCByb290UG9pbnRzWzNdLCByb290UG9pbnRzWzJdXSwgJ2NvbG9yJzogJ3NreWJsdWUnIH0sCiAgICAgICAgICAgIHsgJ3BvaW50cyc6IFtyb290UG9pbnRzWzVdLCByb290UG9pbnRzWzFdLCByb290UG9pbnRzWzJdXSwgJ2NvbG9yJzogJ3JlZCcgfSwKICAgICAgICAgICAgeyAncG9pbnRzJzogW3Jvb3RQb2ludHNbNV0sIHJvb3RQb2ludHNbMl0sIHJvb3RQb2ludHNbM11dLCAnY29sb3InOiAnZGFya29yYW5nZScgfSwKICAgICAgICAgICAgeyAncG9pbnRzJzogW3Jvb3RQb2ludHNbNV0sIHJvb3RQb2ludHNbM10sIHJvb3RQb2ludHNbNF1dLCAnY29sb3InOiAncHVycGxlJyB9LAogICAgICAgICAgICB7ICdwb2ludHMnOiBbcm9vdFBvaW50c1s1XSwgcm9vdFBvaW50c1s0XSwgcm9vdFBvaW50c1sxXV0sICdjb2xvcic6ICd5ZWxsb3cnIH0KICAgICAgICBdOwogICAgICAgIGxldCBjeWNsZUZhbWlseUNvbmZpZyA9IFt7CiAgICAgICAgICAgICdzbGljZXMnOiBbCiAgICAgICAgICAgICAgICB7IGZJbmRleDogNCwgc0lKOiByb3cgPT4gW3NpemUgLSByb3cgLSAxLCAyICogKHNpemUgLSByb3cgLSAxKV0sIGRJSjogKCkgPT4gWzAsIC0xXSwgbGltSjogcm93ID0+IDEgKyAyICogKHNpemUgLSByb3cgLSAxKSB9LAogICAgICAgICAgICAgICAgeyBmSW5kZXg6IDcsIHNJSjogcm93ID0+IFtzaXplIC0gcm93IC0gMSwgMiAqIChzaXplIC0gcm93IC0gMSldLCBkSUo6IChfcm93LCBjb2wpID0+IFtjb2wgJSAyID8gMCA6IDEsIGNvbCAlIDIgPyAtMSA6IDFdLCBsaW1KOiByb3cgPT4gMSArIDIgKiByb3cgfSwKICAgICAgICAgICAgICAgIHsgZkluZGV4OiAxLCBzSUo6IHJvdyA9PiBbc2l6ZSAtIDEsIDIgKiByb3ddLCBkSUo6IChfcm93LCBjb2wpID0+IFtjb2wgJSAyID8gLTEgOiAwLCBjb2wgJSAyID8gLTEgOiAxXSwgbGltSjogcm93ID0+IDEgKyAyICogKHNpemUgLSByb3cgLSAxKSB9LAogICAgICAgICAgICAgICAgeyBmSW5kZXg6IDIsIHNJSjogcm93ID0+IFtyb3csIDBdLCBkSUo6ICgpID0+IFswLCAxXSwgbGltSjogcm93ID0+IDEgKyAyICogcm93IH0sCiAgICAgICAgICAgICAgICB7IGZJbmRleDogMywgc0lKOiByb3cgPT4gW3JvdywgMF0sIGRJSjogKF9yb3csIGNvbCkgPT4gW2NvbCAlIDIgPyAwIDogMSwgMV0sIGxpbUo6IHJvdyA9PiAxICsgMiAqIChzaXplIC0gcm93IC0gMSkgfSwKICAgICAgICAgICAgICAgIHsgZkluZGV4OiA1LCBzSUo6IHJvdyA9PiBbc2l6ZSAtIDEsIDIgKiByb3ddLCBkSUo6IChfcm93LCBjb2wpID0+IFtjb2wgJSAyID8gLTEgOiAwLCAtMV0sIGxpbUo6IHJvdyA9PiAxICsgMiAqIHJvdyB9CiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICdhdHRhY2hlZEZhY2VzJzogWwogICAgICAgICAgICAgICAgeyBmSW5kZXg6IDAsIHN0ZXBzOiBbKCkgPT4gWzEsIDBdLCAoKSA9PiBbMCwgMl0sICgpID0+IFstMSwgLTJdXSB9LAogICAgICAgICAgICAgICAgeyBmSW5kZXg6IDYsIHN0ZXBzOiBbKCkgPT4gWzEsIDJdLCAoKSA9PiBbMCwgLTJdLCAoKSA9PiBbLTEsIDBdXSB9CiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICd1bml0VmVjdG9yJzogbmV3IFZlY3RvcihuZXcgUG9pbnQoMSwgMSwgLTEpKS51bml0KCkKICAgICAgICB9LCB7CiAgICAgICAgICAgICdzbGljZXMnOiBbCiAgICAgICAgICAgICAgICB7IGZJbmRleDogMCwgc0lKOiByb3cgPT4gW3JvdywgMF0sIGRJSjogKF9yb3csIGNvbCkgPT4gW2NvbCAlIDIgPyAwIDogMSwgMV0sIGxpbUo6IHJvdyA9PiAxICsgMiAqIChzaXplIC0gcm93IC0gMSkgfSwKICAgICAgICAgICAgICAgIHsgZkluZGV4OiA0LCBzSUo6IHJvdyA9PiBbc2l6ZSAtIDEsIDIgKiByb3ddLCBkSUo6IChfcm93LCBjb2wpID0+IFtjb2wgJSAyID8gLTEgOiAwLCAtMV0sIGxpbUo6IHJvdyA9PiAxICsgMiAqIHJvdyB9LAogICAgICAgICAgICAgICAgeyBmSW5kZXg6IDcsIHNJSjogcm93ID0+IFtzaXplIC0gcm93IC0gMSwgMiAqIChzaXplIC0gcm93IC0gMSldLCBkSUo6ICgpID0+IFswLCAtMV0sIGxpbUo6IHJvdyA9PiAxICsgMiAqIChzaXplIC0gcm93IC0gMSkgfSwKICAgICAgICAgICAgICAgIHsgZkluZGV4OiA2LCBzSUo6IHJvdyA9PiBbc2l6ZSAtIHJvdyAtIDEsIDIgKiAoc2l6ZSAtIHJvdyAtIDEpXSwgZElKOiAoX3JvdywgY29sKSA9PiBbY29sICUgMiA/IDAgOiAxLCBjb2wgJSAyID8gLTEgOiAxXSwgbGltSjogcm93ID0+IDEgKyAyICogcm93IH0sCiAgICAgICAgICAgICAgICB7IGZJbmRleDogMiwgc0lKOiByb3cgPT4gW3NpemUgLSAxLCAyICogcm93XSwgZElKOiAoX3JvdywgY29sKSA9PiBbY29sICUgMiA/IC0xIDogMCwgY29sICUgMiA/IC0xIDogMV0sIGxpbUo6IHJvdyA9PiAxICsgMiAqIChzaXplIC0gcm93IC0gMSkgfSwKICAgICAgICAgICAgICAgIHsgZkluZGV4OiAzLCBzSUo6IHJvdyA9PiBbcm93LCAwXSwgZElKOiAoKSA9PiBbMCwgMV0sIGxpbUo6IHJvdyA9PiAxICsgMiAqIHJvdyB9CiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICdhdHRhY2hlZEZhY2VzJzogWwogICAgICAgICAgICAgICAgeyBmSW5kZXg6IDEsIHN0ZXBzOiBbKCkgPT4gWzEsIDBdLCAoKSA9PiBbMCwgMl0sICgpID0+IFstMSwgLTJdXSB9LAogICAgICAgICAgICAgICAgeyBmSW5kZXg6IDUsIHN0ZXBzOiBbKCkgPT4gWzEsIDJdLCAoKSA9PiBbMCwgLTJdLCAoKSA9PiBbLTEsIDBdXSB9CiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICd1bml0VmVjdG9yJzogbmV3IFZlY3RvcihuZXcgUG9pbnQoMSwgLTEsIC0xKSkudW5pdCgpCiAgICAgICAgfSwgewogICAgICAgICAgICAnc2xpY2VzJzogWwogICAgICAgICAgICAgICAgeyBmSW5kZXg6IDEsIHNJSjogcm93ID0+IFtyb3csIDBdLCBkSUo6IChfcm93LCBjb2wpID0+IFtjb2wgJSAyID8gMCA6IDEsIDFdLCBsaW1KOiByb3cgPT4gMSArIDIgKiAoc2l6ZSAtIHJvdyAtIDEpIH0sCiAgICAgICAgICAgICAgICB7IGZJbmRleDogNywgc0lKOiByb3cgPT4gW3NpemUgLSAxLCAyICogcm93XSwgZElKOiAoX3JvdywgY29sKSA9PiBbY29sICUgMiA/IC0xIDogMCwgLTFdLCBsaW1KOiByb3cgPT4gMSArIDIgKiByb3cgfSwKICAgICAgICAgICAgICAgIHsgZkluZGV4OiA2LCBzSUo6IHJvdyA9PiBbc2l6ZSAtIHJvdyAtIDEsIDIgKiAoc2l6ZSAtIHJvdyAtIDEpXSwgZElKOiAoKSA9PiBbMCwgLTFdLCBsaW1KOiByb3cgPT4gMSArIDIgKiAoc2l6ZSAtIHJvdyAtIDEpIH0sCiAgICAgICAgICAgICAgICB7IGZJbmRleDogNSwgc0lKOiByb3cgPT4gW3NpemUgLSByb3cgLSAxLCAyICogKHNpemUgLSByb3cgLSAxKV0sIGRJSjogKF9yb3csIGNvbCkgPT4gW2NvbCAlIDIgPyAwIDogMSwgY29sICUgMiA/IC0xIDogMV0sIGxpbUo6IHJvdyA9PiAxICsgMiAqIHJvdyB9LAogICAgICAgICAgICAgICAgeyBmSW5kZXg6IDMsIHNJSjogcm93ID0+IFtzaXplIC0gMSwgMiAqIHJvd10sIGRJSjogKF9yb3csIGNvbCkgPT4gW2NvbCAlIDIgPyAtMSA6IDAsIGNvbCAlIDIgPyAtMSA6IDFdLCBsaW1KOiByb3cgPT4gMSArIDIgKiAoc2l6ZSAtIHJvdyAtIDEpIH0sCiAgICAgICAgICAgICAgICB7IGZJbmRleDogMCwgc0lKOiByb3cgPT4gW3JvdywgMF0sIGRJSjogKCkgPT4gWzAsIDFdLCBsaW1KOiByb3cgPT4gMSArIDIgKiByb3cgfQogICAgICAgICAgICBdLAogICAgICAgICAgICAnYXR0YWNoZWRGYWNlcyc6IFsKICAgICAgICAgICAgICAgIHsgZkluZGV4OiAyLCBzdGVwczogWygpID0+IFsxLCAwXSwgKCkgPT4gWzAsIDJdLCAoKSA9PiBbLTEsIC0yXV0gfSwKICAgICAgICAgICAgICAgIHsgZkluZGV4OiA0LCBzdGVwczogWygpID0+IFsxLCAyXSwgKCkgPT4gWzAsIC0yXSwgKCkgPT4gWy0xLCAwXV0gfQogICAgICAgICAgICBdLAogICAgICAgICAgICAndW5pdFZlY3Rvcic6IG5ldyBWZWN0b3IobmV3IFBvaW50KC0xLCAtMSwgLTEpKS51bml0KCkKICAgICAgICB9LCB7CiAgICAgICAgICAgICdzbGljZXMnOiBbCiAgICAgICAgICAgICAgICB7IGZJbmRleDogMiwgc0lKOiByb3cgPT4gW3JvdywgMF0sIGRJSjogKF9yb3csIGNvbCkgPT4gW2NvbCAlIDIgPyAwIDogMSwgMV0sIGxpbUo6IHJvdyA9PiAxICsgMiAqIChzaXplIC0gcm93IC0gMSkgfSwKICAgICAgICAgICAgICAgIHsgZkluZGV4OiA2LCBzSUo6IHJvdyA9PiBbc2l6ZSAtIDEsIDIgKiByb3ddLCBkSUo6IChfcm93LCBjb2wpID0+IFtjb2wgJSAyID8gLTEgOiAwLCAtMV0sIGxpbUo6IHJvdyA9PiAxICsgMiAqIHJvdyB9LAogICAgICAgICAgICAgICAgeyBmSW5kZXg6IDUsIHNJSjogcm93ID0+IFtzaXplIC0gcm93IC0gMSwgMiAqIChzaXplIC0gcm93IC0gMSldLCBkSUo6ICgpID0+IFswLCAtMV0sIGxpbUo6IHJvdyA9PiAxICsgMiAqIChzaXplIC0gcm93IC0gMSkgfSwKICAgICAgICAgICAgICAgIHsgZkluZGV4OiA0LCBzSUo6IHJvdyA9PiBbc2l6ZSAtIHJvdyAtIDEsIDIgKiAoc2l6ZSAtIHJvdyAtIDEpXSwgZElKOiAoX3JvdywgY29sKSA9PiBbY29sICUgMiA/IDAgOiAxLCBjb2wgJSAyID8gLTEgOiAxXSwgbGltSjogcm93ID0+IDEgKyAyICogcm93IH0sCiAgICAgICAgICAgICAgICB7IGZJbmRleDogMCwgc0lKOiByb3cgPT4gW3NpemUgLSAxLCAyICogcm93XSwgZElKOiAoX3JvdywgY29sKSA9PiBbY29sICUgMiA/IC0xIDogMCwgY29sICUgMiA/IC0xIDogMV0sIGxpbUo6IHJvdyA9PiAxICsgMiAqIChzaXplIC0gcm93IC0gMSkgfSwKICAgICAgICAgICAgICAgIHsgZkluZGV4OiAxLCBzSUo6IHJvdyA9PiBbcm93LCAwXSwgZElKOiAoKSA9PiBbMCwgMV0sIGxpbUo6IHJvdyA9PiAxICsgMiAqIHJvdyB9CiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICdhdHRhY2hlZEZhY2VzJzogWwogICAgICAgICAgICAgICAgeyBmSW5kZXg6IDMsIHN0ZXBzOiBbKCkgPT4gWzEsIDBdLCAoKSA9PiBbMCwgMl0sICgpID0+IFstMSwgLTJdXSB9LAogICAgICAgICAgICAgICAgeyBmSW5kZXg6IDcsIHN0ZXBzOiBbKCkgPT4gWzEsIDJdLCAoKSA9PiBbMCwgLTJdLCAoKSA9PiBbLTEsIDBdXSB9CiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICd1bml0VmVjdG9yJzogbmV3IFZlY3RvcihuZXcgUG9pbnQoLTEsIDEsIC0xKSkudW5pdCgpCiAgICAgICAgfV07CgoKICAgICAgICBmYWNlQ29uZmlnLmZvckVhY2goKGNvbmZpZywgZikgPT4gewogICAgICAgICAgICBsZXQgc3RpY2tlcnMgPSBbXTsKICAgICAgICAgICAgbGV0IHByZUFyciA9IFtjb25maWcucG9pbnRzWzBdLmNsb25lKCldLCBueHRBcnIsIHAsIHEsIHIsIHM7CiAgICAgICAgICAgIGxldCB2SSA9IG5ldyBWZWN0b3IoY29uZmlnLnBvaW50c1swXSwgY29uZmlnLnBvaW50c1sxXSkubXVsdGlwbHkoMSAvIHNpemUpOwogICAgICAgICAgICBsZXQgdkogPSBuZXcgVmVjdG9yKGNvbmZpZy5wb2ludHNbMV0sIGNvbmZpZy5wb2ludHNbMl0pLm11bHRpcGx5KDEgLyBzaXplKTsKICAgICAgICAgICAgbGV0IHZDOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNpemU7IGkrKykgewogICAgICAgICAgICAgICAgbnh0QXJyID0gW107CiAgICAgICAgICAgICAgICB2QyA9IHZJLmFkZChwcmVBcnJbMF0pOwogICAgICAgICAgICAgICAgbnh0QXJyLnB1c2gobmV3IFBvaW50KHZDLngsIHZDLnksIHZDLnopKTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDw9IGk7IGorKykgewogICAgICAgICAgICAgICAgICAgIHZDID0gdkouYWRkKHZDKTsKICAgICAgICAgICAgICAgICAgICBueHRBcnIucHVzaChuZXcgUG9pbnQodkMueCwgdkMueSwgdkMueikpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcHJlQXJyLmZvckVhY2goKHBvaW50LCBqKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcCA9IHBvaW50LmNsb25lKCk7CiAgICAgICAgICAgICAgICAgICAgcSA9IG54dEFycltqXS5jbG9uZSgpOwogICAgICAgICAgICAgICAgICAgIHIgPSBueHRBcnJbaiArIDFdLmNsb25lKCk7CiAgICAgICAgICAgICAgICAgICAgcC5pZCA9IGBwLSR7Zn0tJHtpfS0ke2p9YDsKICAgICAgICAgICAgICAgICAgICBxLmlkID0gYHAtJHtmfS0ke2kgKyAxfS0ke2p9YDsKICAgICAgICAgICAgICAgICAgICByLmlkID0gYHAtJHtmfS0ke2kgKyAxfS0ke2ogKyAxfWA7CiAgICAgICAgICAgICAgICAgICAgZ3JpZFtwLmlkXSA9IHAuY2xvbmUoKTsKICAgICAgICAgICAgICAgICAgICBncmlkW3EuaWRdID0gcS5jbG9uZSgpOwogICAgICAgICAgICAgICAgICAgIGdyaWRbci5pZF0gPSByLmNsb25lKCk7CiAgICAgICAgICAgICAgICAgICAgc3RpY2tlcnMucHVzaChuZXcgU3RpY2tlcihgcy0ke2Z9LSR7aX0tJHsyICogan1gLCBjb25maWcuY29sb3IsIFtwLCBxLCByXSkpOwogICAgICAgICAgICAgICAgICAgIHN0aWNrZXJNYXBbc3RpY2tlcnNbc3RpY2tlcnMubGVuZ3RoIC0gMV0uaWRdID0gc3RpY2tlcnNbc3RpY2tlcnMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgICAgICAgICAgaWYgKGogPCBwcmVBcnIubGVuZ3RoIC0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICBwID0gcC5jbG9uZSgpOwogICAgICAgICAgICAgICAgICAgICAgICByID0gci5jbG9uZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBzID0gcHJlQXJyW2ogKyAxXS5jbG9uZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBzLmlkID0gYHEtJHtmfS0ke2l9LSR7aiArIDF9YDsKICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZFtwLmlkXSA9IHAuY2xvbmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZFtyLmlkXSA9IHIuY2xvbmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZFtzLmlkXSA9IHMuY2xvbmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgc3RpY2tlcnMucHVzaChuZXcgU3RpY2tlcihgcy0ke2Z9LSR7aX0tJHsyICogaiArIDF9YCwgY29uZmlnLmNvbG9yLCBbcCwgciwgc10pKTsKICAgICAgICAgICAgICAgICAgICAgICAgc3RpY2tlck1hcFtzdGlja2Vyc1tzdGlja2Vycy5sZW5ndGggLSAxXS5pZF0gPSBzdGlja2Vyc1tzdGlja2Vycy5sZW5ndGggLSAxXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHByZUFyciA9IG54dEFycjsKICAgICAgICAgICAgfQogICAgICAgICAgICBmYWNlcy5wdXNoKG5ldyBGYWNlKHN0aWNrZXJzKSk7CiAgICAgICAgfSk7CiAgICAgICAgbGV0IGN5Y2xlLCBhRmFjZSwgc3RpY2tlckNvbGxlY3Rpb24sIHNJLCBzSiwgZEksIGRKLCBsSjsKICAgICAgICBjeWNsZUZhbWlseUNvbmZpZy5mb3JFYWNoKGNvbmZpZyA9PiB7CiAgICAgICAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgc2l6ZTsgYysrKSB7CiAgICAgICAgICAgICAgICBjeWNsZSA9IG5ldyBDeWNsZShbXSwgMywgY29uZmlnLnVuaXRWZWN0b3IsIGFuaW1hdGlvbkNvbmZpZyk7CiAgICAgICAgICAgICAgICBzdGlja2VyQ29sbGVjdGlvbiA9IFtdOwogICAgICAgICAgICAgICAgY29uZmlnLnNsaWNlcy5mb3JFYWNoKChzbGljZSkgPT4gewogICAgICAgICAgICAgICAgICAgIFtzSSwgc0pdID0gc2xpY2Uuc0lKKGMpOwogICAgICAgICAgICAgICAgICAgIGxKID0gc2xpY2UubGltSihjKTsKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBzID0gMDsgcyA8IGxKOyBzKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgW2RJLCBkSl0gPSBzbGljZS5kSUooYywgcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0aWNrZXJDb2xsZWN0aW9uLnB1c2goc3RpY2tlck1hcFtgcy0ke3NsaWNlLmZJbmRleH0tJHtzSX0tJHtzSn1gXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNJICs9IGRJOwogICAgICAgICAgICAgICAgICAgICAgICBzSiArPSBkSjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGN5Y2xlLnN0aWNrZXJDb2xsZWN0aW9ucy5wdXNoKHN0aWNrZXJDb2xsZWN0aW9uKTsKICAgICAgICAgICAgICAgIGN5Y2xlcy5wdXNoKGN5Y2xlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25maWcuYXR0YWNoZWRGYWNlcy5mb3JFYWNoKChmYWNlQ3ljbGVDb25maWcsIGZjaSkgPT4gewogICAgICAgICAgICAgICAgY3ljbGUgPSBmY2kgPyBjeWNsZXNbY3ljbGVzLmxlbmd0aCAtIDFdIDogY3ljbGVzW2N5Y2xlcy5sZW5ndGggLSBzaXplXTsKICAgICAgICAgICAgICAgIGFGYWNlID0gZmFjZUN5Y2xlQ29uZmlnLmZJbmRleDsKICAgICAgICAgICAgICAgIGxldCBsID0gc2l6ZSAtIDE7CiAgICAgICAgICAgICAgICBsZXQgZCA9IDE7CiAgICAgICAgICAgICAgICBsZXQgcyA9IDAsIHQsIGksIGo7CiAgICAgICAgICAgICAgICB3aGlsZSAobCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBpID0gaiA9IHM7CiAgICAgICAgICAgICAgICAgICAgc3RpY2tlckNvbGxlY3Rpb24gPSBbXTsKICAgICAgICAgICAgICAgICAgICBmYWNlQ3ljbGVDb25maWcuc3RlcHMuZm9yRWFjaChzdGVwQ29uZmlnR2V0dGVyID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgdCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgbDsgeCsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgW3N0ZXBJLCBzdGVwSl0gPSBzdGVwQ29uZmlnR2V0dGVyKHMsIHQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RpY2tlckNvbGxlY3Rpb24ucHVzaChzdGlja2VyTWFwW2BzLSR7YUZhY2V9LSR7aX0tJHtqfWBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgKz0gc3RlcEk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqICs9IHN0ZXBKOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdCArPSAxOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgY3ljbGUuc3RpY2tlckNvbGxlY3Rpb25zLnB1c2goc3RpY2tlckNvbGxlY3Rpb24pOwogICAgICAgICAgICAgICAgICAgIHMgKz0gMTsKICAgICAgICAgICAgICAgICAgICBsIC09IGQ7CiAgICAgICAgICAgICAgICAgICAgZCA9IGQgPT09IDIgPyAxIDogMjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChzdGlja2VyTWFwW2BzLSR7YUZhY2V9LSR7c30tJHtzfWBdKSB7CiAgICAgICAgICAgICAgICAgICAgY3ljbGUuc3RpY2tlckNvbGxlY3Rpb25zLnB1c2goW3N0aWNrZXJNYXBbYHMtJHthRmFjZX0tJHtzfS0ke3N9YF1dKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICB9KTsKICAgICAgICBjeWNsZXMuZm9yRWFjaChjeWNsZSA9PiB7CiAgICAgICAgICAgIGN5Y2xlLnN0aWNrZXJDb2xsZWN0aW9uc1swXS5pc1ByaW1hcnkgPSB0cnVlOwogICAgICAgICAgICBjeWNsZS5jb21wdXRlU3RpY2tlckNvdmVyKCkKICAgICAgICB9KTsKICAgICAgICBzdXBlcihmYWNlcywgY3ljbGVzKTsKCiAgICAgICAgdGhpcy5zYXZlT3JpZW50YXRpb24oewogICAgICAgICAgICAnYXhpcyc6IG5ldyBWZWN0b3IoeyB4OiAwLCB5OiAxLCB6OiAwfSksCiAgICAgICAgICAgICdhbmdsZSc6IE1hdGguUEkgLyAxMgogICAgICAgIH0pOwogICAgICAgIHRoaXMuc2F2ZU9yaWVudGF0aW9uKHsKICAgICAgICAgICAgJ2F4aXMnOiBuZXcgVmVjdG9yKHsgeDogMSwgeTogMCwgejogMH0pLAogICAgICAgICAgICAnYW5nbGUnOiBNYXRoLlBJIC8gMjQKICAgICAgICB9KTsKICAgIH0KfQoKPC9zY3JpcHQ+CiAgICA8c2NyaXB0IHR5cGU9ImFwcGxpY2F0aW9uL2phdmFzY3JpcHQiPmNsYXNzIERvZGVjYWhlZHJvbiBleHRlbmRzIFB1enpsZSB7CiAgICBjb25zdHJ1Y3RvcihzaXplID0gMSwgd2lkdGggPSAyMDApIHsKICAgICAgICBjb25zdCBwaGkgPSAoMSArIE1hdGguc3FydCg1KSkgLyAyOwogICAgICAgIGNvbnN0IHNjYWxlID0gd2lkdGggLyAyOwogICAgICAgIGNvbnN0IHNjYWxlZFBoaSA9IHNjYWxlICogcGhpOwogICAgICAgIGNvbnN0IHNjYWxlZFBoaUludmVyc2UgPSBzY2FsZSAqIDEgLyBwaGk7CiAgICAgICAgY29uc3QgZmFjZXMgPSBbXTsKICAgICAgICBjb25zdCBjeWNsZXMgPSBbXTsKICAgICAgICBjb25zdCBncmlkID0ge307CiAgICAgICAgY29uc3Qgc3RpY2tlck1hcCA9IHt9OwogICAgICAgIGNvbnN0IGFscGhhTSA9IDIgKiBNYXRoLlBJIC8gNTsKICAgICAgICBjb25zdCBhbmltYXRpb25TdGVwcyA9IDEwOwogICAgICAgIGNvbnN0IGFuaW1hdGlvbkNvbmZpZyA9IHsKICAgICAgICAgICAgc3RlcHM6IGFuaW1hdGlvblN0ZXBzLAogICAgICAgICAgICBkQWxwaGE6IGFscGhhTSAvIGFuaW1hdGlvblN0ZXBzCiAgICAgICAgfTsKICAgICAgICBjb25zdCByb290UG9pbnRzID0gWwogICAgICAgICAgICBuZXcgUG9pbnQoc2NhbGUsIHNjYWxlLCBzY2FsZSwgJ3IwJyksCiAgICAgICAgICAgIG5ldyBQb2ludChzY2FsZSwgc2NhbGUsIC1zY2FsZSwgJ3IxJyksCiAgICAgICAgICAgIG5ldyBQb2ludChzY2FsZSwgLXNjYWxlLCBzY2FsZSwgJ3IyJyksCiAgICAgICAgICAgIG5ldyBQb2ludChzY2FsZSwgLXNjYWxlLCAtc2NhbGUsICdyMycpLAogICAgICAgICAgICBuZXcgUG9pbnQoLXNjYWxlLCBzY2FsZSwgc2NhbGUsICdyNCcpLAogICAgICAgICAgICBuZXcgUG9pbnQoLXNjYWxlLCBzY2FsZSwgLXNjYWxlLCAncjUnKSwKICAgICAgICAgICAgbmV3IFBvaW50KC1zY2FsZSwgLXNjYWxlLCBzY2FsZSwgJ3I2JyksCiAgICAgICAgICAgIG5ldyBQb2ludCgtc2NhbGUsIC1zY2FsZSwgLXNjYWxlLCAncjcnKSwKCiAgICAgICAgICAgIG5ldyBQb2ludChzY2FsZWRQaGksIHNjYWxlZFBoaUludmVyc2UsIDAsICdyOCcpLAogICAgICAgICAgICBuZXcgUG9pbnQoc2NhbGVkUGhpLCAtc2NhbGVkUGhpSW52ZXJzZSwgMCwgJ3I5JyksCiAgICAgICAgICAgIG5ldyBQb2ludCgtc2NhbGVkUGhpLCBzY2FsZWRQaGlJbnZlcnNlLCAwLCAncjEwJyksCiAgICAgICAgICAgIG5ldyBQb2ludCgtc2NhbGVkUGhpLCAtc2NhbGVkUGhpSW52ZXJzZSwgMCwgJ3IxMScpLAoKICAgICAgICAgICAgbmV3IFBvaW50KDAsIHNjYWxlZFBoaSwgc2NhbGVkUGhpSW52ZXJzZSwgJ3IxMicpLAogICAgICAgICAgICBuZXcgUG9pbnQoMCwgc2NhbGVkUGhpLCAtc2NhbGVkUGhpSW52ZXJzZSwgJ3IxMycpLAogICAgICAgICAgICBuZXcgUG9pbnQoMCwgLXNjYWxlZFBoaSwgc2NhbGVkUGhpSW52ZXJzZSwgJ3IxNCcpLAogICAgICAgICAgICBuZXcgUG9pbnQoMCwgLXNjYWxlZFBoaSwgLXNjYWxlZFBoaUludmVyc2UsICdyMTUnKSwKCiAgICAgICAgICAgIG5ldyBQb2ludChzY2FsZWRQaGlJbnZlcnNlLCAwLCBzY2FsZWRQaGksICdyMTYnKSwKICAgICAgICAgICAgbmV3IFBvaW50KHNjYWxlZFBoaUludmVyc2UsIDAsIC1zY2FsZWRQaGksICdyMTcnKSwKICAgICAgICAgICAgbmV3IFBvaW50KC1zY2FsZWRQaGlJbnZlcnNlLCAwLCBzY2FsZWRQaGksICdyMTgnKSwKICAgICAgICAgICAgbmV3IFBvaW50KC1zY2FsZWRQaGlJbnZlcnNlLCAwLCAtc2NhbGVkUGhpLCAncjE5JykKICAgICAgICBdOwogICAgICAgIGNvbnN0IGZhY2VDb25maWcgPSBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICdwb2ludHMnOiBbcm9vdFBvaW50c1s4XSxyb290UG9pbnRzWzFdLHJvb3RQb2ludHNbMTNdLHJvb3RQb2ludHNbMTJdLHJvb3RQb2ludHNbMF1dLAogICAgICAgICAgICAgICAgJ2NvbG9yJzogJ3B1cnBsZScKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgJ3BvaW50cyc6IFtyb290UG9pbnRzWzldLHJvb3RQb2ludHNbMl0scm9vdFBvaW50c1sxNF0scm9vdFBvaW50c1sxNV0scm9vdFBvaW50c1szXV0sCiAgICAgICAgICAgICAgICAnY29sb3InOiAnbWFnZW50YScKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgJ3BvaW50cyc6IFtyb290UG9pbnRzWzEwXSxyb290UG9pbnRzWzRdLHJvb3RQb2ludHNbMTJdLHJvb3RQb2ludHNbMTNdLHJvb3RQb2ludHNbNV1dLAogICAgICAgICAgICAgICAgJ2NvbG9yJzogJ3doaXRlJwogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAncG9pbnRzJzogW3Jvb3RQb2ludHNbMTFdLHJvb3RQb2ludHNbN10scm9vdFBvaW50c1sxNV0scm9vdFBvaW50c1sxNF0scm9vdFBvaW50c1s2XV0sCiAgICAgICAgICAgICAgICAnY29sb3InOiAneWVsbG93JwogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAncG9pbnRzJzogW3Jvb3RQb2ludHNbMTJdLHJvb3RQb2ludHNbNF0scm9vdFBvaW50c1sxOF0scm9vdFBvaW50c1sxNl0scm9vdFBvaW50c1swXV0sCiAgICAgICAgICAgICAgICAnY29sb3InOiAncGluaycKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgJ3BvaW50cyc6IFtyb290UG9pbnRzWzEzXSxyb290UG9pbnRzWzFdLHJvb3RQb2ludHNbMTddLHJvb3RQb2ludHNbMTldLHJvb3RQb2ludHNbNV1dLAogICAgICAgICAgICAgICAgJ2NvbG9yJzogJ2JsdWUnCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICdwb2ludHMnOiBbcm9vdFBvaW50c1sxNF0scm9vdFBvaW50c1syXSxyb290UG9pbnRzWzE2XSxyb290UG9pbnRzWzE4XSxyb290UG9pbnRzWzZdXSwKICAgICAgICAgICAgICAgICdjb2xvcic6ICdncmVlbicKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgJ3BvaW50cyc6IFtyb290UG9pbnRzWzE1XSxyb290UG9pbnRzWzddLHJvb3RQb2ludHNbMTldLHJvb3RQb2ludHNbMTddLHJvb3RQb2ludHNbM11dLAogICAgICAgICAgICAgICAgJ2NvbG9yJzogJ2NyaW1zb24nCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICdwb2ludHMnOiBbcm9vdFBvaW50c1sxNl0scm9vdFBvaW50c1syXSxyb290UG9pbnRzWzldLHJvb3RQb2ludHNbOF0scm9vdFBvaW50c1swXV0sCiAgICAgICAgICAgICAgICAnY29sb3InOiAncmVkJwogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAncG9pbnRzJzogW3Jvb3RQb2ludHNbMTddLHJvb3RQb2ludHNbMV0scm9vdFBvaW50c1s4XSxyb290UG9pbnRzWzldLHJvb3RQb2ludHNbM11dLAogICAgICAgICAgICAgICAgJ2NvbG9yJzogJ2xhd25ncmVlbicKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgJ3BvaW50cyc6IFtyb290UG9pbnRzWzE4XSxyb290UG9pbnRzWzRdLHJvb3RQb2ludHNbMTBdLHJvb3RQb2ludHNbMTFdLHJvb3RQb2ludHNbNl1dLAogICAgICAgICAgICAgICAgJ2NvbG9yJzogJ2Jyb3duJwogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAncG9pbnRzJzogW3Jvb3RQb2ludHNbMTldLHJvb3RQb2ludHNbN10scm9vdFBvaW50c1sxMV0scm9vdFBvaW50c1sxMF0scm9vdFBvaW50c1s1XV0sCiAgICAgICAgICAgICAgICAnY29sb3InOiAnc2t5Ymx1ZScKICAgICAgICAgICAgfQogICAgICAgIF07CiAgICAgICAgY29uc3QgZ2V0Q3ljbGVWZWN0b3IgPSBhdHRhY2hlZEZhY2UgPT4gZmFjZUNvbmZpZ1thdHRhY2hlZEZhY2VdLnBvaW50cy5yZWR1Y2UoKHYsIHApID0+IHYuYWRkKHApLCBuZXcgVmVjdG9yKHt4OjAseTowLHo6MH0pKTsKICAgICAgICBjb25zdCBjeWNsZUZhbWlseUNvbmZpZyA9IFtdOwogICAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgMTI7IGMrKykgewogICAgICAgICAgICBsZXQgY3ljbGVDb25maWcgPSB7ICd1bml0VmVjdG9yJzogZ2V0Q3ljbGVWZWN0b3IoYyksICdzbGljZXMnOiB7IGxlbmd0aDogNSB9IH07CiAgICAgICAgICAgIGxldCBmYWNlLCBzdGFydFYsIGVuZFY7CiAgICAgICAgICAgIGZvciAoZmFjZSA9IDA7IGZhY2UgPCAxMjsgZmFjZSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoZmFjZSAhPSBjKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgdSA9IDA7IHUgPCA1OyB1KyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgdiA9IDA7IHYgPCA1OyB2KyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmYWNlQ29uZmlnW2NdLnBvaW50c1t1XS5pZCA9PSBmYWNlQ29uZmlnW2ZhY2VdLnBvaW50c1t2XS5pZCAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhY2VDb25maWdbY10ucG9pbnRzW21vZCh1ICsgMSwgNSldLmlkID09IGZhY2VDb25maWdbZmFjZV0ucG9pbnRzW21vZCh2IC0gMSwgNSldLmlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRWID0gdjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRWID0gbW9kKHYgLSAxLCA1KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjeWNsZUNvbmZpZy5zbGljZXNbdV0gPSB7IGZhY2UsIHN0YXJ0ViwgZW5kViB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGN5Y2xlQ29uZmlnLnNsaWNlcyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5hcHBseShjeWNsZUNvbmZpZy5zbGljZXMpOwogICAgICAgICAgICBjeWNsZUZhbWlseUNvbmZpZy5wdXNoKGN5Y2xlQ29uZmlnKTsKICAgICAgICB9CiAgICAgICAgZmFjZUNvbmZpZy5mb3JFYWNoKChjb25maWcsIGYpID0+IHsKICAgICAgICAgICAgY29uc3Qgc3RpY2tlcnMgPSBbXTsKICAgICAgICAgICAgY29uZmlnLnBvaW50cy5mb3JFYWNoKChyZWZQb2ludCwgcCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgYmFzZVZlY3RvciA9IG5ldyBWZWN0b3IocmVmUG9pbnQpOwogICAgICAgICAgICAgICAgY29uc3QgdkkgPSBuZXcgVmVjdG9yKHJlZlBvaW50LCBjb25maWcucG9pbnRzW21vZChwICsgMSwgY29uZmlnLnBvaW50cy5sZW5ndGgpXSkubXVsdGlwbHkoMSAvICgyICogc2l6ZSkpOwogICAgICAgICAgICAgICAgY29uc3QgdkogPSBuZXcgVmVjdG9yKHJlZlBvaW50LCBjb25maWcucG9pbnRzW21vZChwIC0gMSwgY29uZmlnLnBvaW50cy5sZW5ndGgpXSkubXVsdGlwbHkoMSAvICgyICogc2l6ZSkpOwogICAgICAgICAgICAgICAgbGV0IHBvaW50VmVjdG9yLCBpLCBqOwogICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8PSBzaXplOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKGogPSAwOyBqIDw9IHNpemU7IGorKykgewogICAgICAgICAgICAgICAgICAgICAgICBwb2ludFZlY3RvciA9IGJhc2VWZWN0b3IuYWRkKHZJLm11bHRpcGx5KGkpKS5hZGQodkoubXVsdGlwbHkoaikpOwogICAgICAgICAgICAgICAgICAgICAgICBncmlkW2BwLSR7Zn0tJHtwfS0ke2l9LSR7an1gXSA9IG5ldyBQb2ludChwb2ludFZlY3Rvci54LCBwb2ludFZlY3Rvci55LCBwb2ludFZlY3Rvci56KTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkgJiYgaikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RpY2tlcnMucHVzaChuZXcgU3RpY2tlcigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgcy0ke2Z9LSR7cH0tJHtpIC0gMX0tJHtqIC0gMX1gLCBjb25maWcuY29sb3IsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmlkW2BwLSR7Zn0tJHtwfS0ke2l9LSR7an1gXS5jbG9uZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmlkW2BwLSR7Zn0tJHtwfS0ke2kgLSAxfS0ke2p9YF0uY2xvbmUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZFtgcC0ke2Z9LSR7cH0tJHtpIC0gMX0tJHtqIC0gMX1gXS5jbG9uZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmlkW2BwLSR7Zn0tJHtwfS0ke2l9LSR7aiAtIDF9YF0uY2xvbmUoKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0aWNrZXJNYXBbc3RpY2tlcnNbc3RpY2tlcnMubGVuZ3RoIC0gMV0uaWRdID0gc3RpY2tlcnNbc3RpY2tlcnMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb25zdCB2bCA9IG5ldyBWZWN0b3IoY29uZmlnLnBvaW50c1ttb2QocCwgY29uZmlnLnBvaW50cy5sZW5ndGgpXSwgY29uZmlnLnBvaW50c1ttb2QocCAtIDEsIGNvbmZpZy5wb2ludHMubGVuZ3RoKV0pLm11bHRpcGx5KDEgLyAoMiAqIHNpemUpKTsKICAgICAgICAgICAgICAgIGNvbnN0IHZyID0gbmV3IFZlY3Rvcihjb25maWcucG9pbnRzW21vZChwICsgMSwgY29uZmlnLnBvaW50cy5sZW5ndGgpXSwgY29uZmlnLnBvaW50c1ttb2QocCArIDIsIGNvbmZpZy5wb2ludHMubGVuZ3RoKV0pLm11bHRpcGx5KDEgLyAoMiAqIHNpemUpKTsKICAgICAgICAgICAgICAgIGNvbnN0IG1pZFZlY3RvciA9IGJhc2VWZWN0b3IuYWRkKHZJLm11bHRpcGx5KHNpemUpKTsKICAgICAgICAgICAgICAgIGxldCBsVmVjdG9yLCByVmVjdG9yOwogICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8PSBzaXplOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBsVmVjdG9yID0gbWlkVmVjdG9yLmFkZCh2bC5tdWx0aXBseShpKSk7CiAgICAgICAgICAgICAgICAgICAgclZlY3RvciA9IG1pZFZlY3Rvci5hZGQodnIubXVsdGlwbHkoaSkpOwogICAgICAgICAgICAgICAgICAgIGdyaWRbYHAtbS0ke2Z9LSR7cH0tJHtpfS1sYF0gPSBuZXcgUG9pbnQobFZlY3Rvci54LCBsVmVjdG9yLnksIGxWZWN0b3Iueik7CiAgICAgICAgICAgICAgICAgICAgZ3JpZFtgcC1tLSR7Zn0tJHtwfS0ke2l9LXJgXSA9IG5ldyBQb2ludChyVmVjdG9yLngsIHJWZWN0b3IueSwgclZlY3Rvci56KTsKICAgICAgICAgICAgICAgICAgICBpZiAoaSkgewogICAgICAgICAgICAgICAgICAgICAgICBzdGlja2Vycy5wdXNoKG5ldyBTdGlja2VyKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYHMtJHtmfS0ke3B9LSR7aSAtIDF9LSR7c2l6ZX1gLCBjb25maWcuY29sb3IsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZFtgcC1tLSR7Zn0tJHtwfS0ke2l9LWxgXS5jbG9uZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRbYHAtbS0ke2Z9LSR7cH0tJHtpfS1yYF0uY2xvbmUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmlkW2BwLW0tJHtmfS0ke3B9LSR7aSAtIDF9LXJgXS5jbG9uZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRbYHAtbS0ke2Z9LSR7cH0tJHtpIC0gMX0tbGBdLmNsb25lKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICAgICAgKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0aWNrZXJNYXBbc3RpY2tlcnNbc3RpY2tlcnMubGVuZ3RoIC0gMV0uaWRdID0gc3RpY2tlcnNbc3RpY2tlcnMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uc3QgY1ZlY3RvciA9IGJhc2VWZWN0b3IuYWRkKHZJLm11bHRpcGx5KHNpemUpKS5hZGQodkoubXVsdGlwbHkoc2l6ZSkpOwogICAgICAgICAgICAgICAgZ3JpZFtgcC0ke2Z9LSR7cH1gXSA9IG5ldyBQb2ludChjVmVjdG9yLngsIGNWZWN0b3IueSwgY1ZlY3Rvci56KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHN0aWNrZXJzLnB1c2gobmV3IFN0aWNrZXIoCiAgICAgICAgICAgICAgICBgcy0ke2Z9YCwgY29uZmlnLmNvbG9yLAogICAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgICAgIGdyaWRbYHAtJHtmfS0wYF0uY2xvbmUoKSwKICAgICAgICAgICAgICAgICAgICBncmlkW2BwLSR7Zn0tMWBdLmNsb25lKCksCiAgICAgICAgICAgICAgICAgICAgZ3JpZFtgcC0ke2Z9LTJgXS5jbG9uZSgpLAogICAgICAgICAgICAgICAgICAgIGdyaWRbYHAtJHtmfS0zYF0uY2xvbmUoKSwKICAgICAgICAgICAgICAgICAgICBncmlkW2BwLSR7Zn0tNGBdLmNsb25lKCksCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICkpOwogICAgICAgICAgICBzdGlja2VyTWFwW3N0aWNrZXJzW3N0aWNrZXJzLmxlbmd0aCAtIDFdLmlkXSA9IHN0aWNrZXJzW3N0aWNrZXJzLmxlbmd0aCAtIDFdOwogICAgICAgICAgICBmYWNlcy5wdXNoKG5ldyBGYWNlKHN0aWNrZXJzKSk7CiAgICAgICAgfSk7CiAgICAgICAgY3ljbGVGYW1pbHlDb25maWcuZm9yRWFjaCgoY29uZmlnLCBhdHRhY2hlZEZhY2UpID0+IHsKICAgICAgICAgICAgbGV0IGZpcnN0Q3ljbGU7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2l6ZTsgaSsrKSB7CiAgICAgICAgICAgICAgICBsZXQgY3ljbGUgPSBuZXcgQ3ljbGUoW10sIDUsIGNvbmZpZy51bml0VmVjdG9yLCBhbmltYXRpb25Db25maWcpOwogICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzaXplOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICBsZXQgc3RpY2tlckNvbGxlY3Rpb24gPSBbXTsKICAgICAgICAgICAgICAgICAgICBjb25maWcuc2xpY2VzLmZvckVhY2goc2xpY2UgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBzdGlja2VyQ29sbGVjdGlvbi5wdXNoKHN0aWNrZXJNYXBbYHMtJHtzbGljZS5mYWNlfS0ke3NsaWNlLnN0YXJ0Vn0tJHtpfS0ke2p9YF0pOwogICAgICAgICAgICAgICAgICAgICAgICBzdGlja2VyQ29sbGVjdGlvbi5wdXNoKHN0aWNrZXJNYXBbYHMtJHtzbGljZS5mYWNlfS0ke3NsaWNlLmVuZFZ9LSR7an0tJHtpfWBdKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBjeWNsZS5zdGlja2VyQ29sbGVjdGlvbnMucHVzaChzdGlja2VyQ29sbGVjdGlvbik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsZXQgc3RpY2tlckNvbGxlY3Rpb24gPSBbXTsKICAgICAgICAgICAgICAgIGNvbmZpZy5zbGljZXMuZm9yRWFjaChzbGljZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgc3RpY2tlckNvbGxlY3Rpb24ucHVzaChzdGlja2VyTWFwW2BzLSR7c2xpY2UuZmFjZX0tJHtzbGljZS5lbmRWfS0ke2l9LSR7c2l6ZX1gXSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGN5Y2xlLnN0aWNrZXJDb2xsZWN0aW9ucy5wdXNoKHN0aWNrZXJDb2xsZWN0aW9uKTsKICAgICAgICAgICAgICAgIGN5Y2xlLnN0aWNrZXJDb2xsZWN0aW9ucy5mb3JFYWNoKHN0aWNrZXJDb2xsZWN0aW9uID0+IHN0aWNrZXJDb2xsZWN0aW9uLmlzUHJpbWFyeSA9IHRydWUpOwogICAgICAgICAgICAgICAgY3ljbGVzLnB1c2goY3ljbGUpOwogICAgICAgICAgICAgICAgaWYgKCFpKSBmaXJzdEN5Y2xlID0gY3ljbGU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDw9IHNpemU7IGorKykgewogICAgICAgICAgICAgICAgICAgIGxldCBzdGlja2VyQ29sbGVjdGlvbiA9IFtdOwogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHAgPSAwOyBwIDwgNTsgcCsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0aWNrZXJDb2xsZWN0aW9uLnB1c2goc3RpY2tlck1hcFtgcy0ke2F0dGFjaGVkRmFjZX0tJHtwfS0ke2l9LSR7an1gXSk7CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBmaXJzdEN5Y2xlLnN0aWNrZXJDb2xsZWN0aW9ucy5wdXNoKHN0aWNrZXJDb2xsZWN0aW9uKTsgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZpcnN0Q3ljbGUuc3RpY2tlckNvbGxlY3Rpb25zLnB1c2goW3N0aWNrZXJNYXBbYHMtJHthdHRhY2hlZEZhY2V9YF1dKTsKICAgICAgICB9KTsKICAgICAgICBjeWNsZXMuZm9yRWFjaChjeWNsZSA9PiBjeWNsZS5jb21wdXRlU3RpY2tlckNvdmVyKCkpOwogICAgICAgIHN1cGVyKGZhY2VzLCBjeWNsZXMpOwogICAgICAgIHRoaXMuc2F2ZU9yaWVudGF0aW9uKHsKICAgICAgICAgICAgJ2F4aXMnOiBuZXcgVmVjdG9yKHsgeDogMSwgeTogMCwgejogMH0pLAogICAgICAgICAgICAnYW5nbGUnOiAtIE1hdGguUEkgLyA1CiAgICAgICAgfSk7CiAgICB9Cn08L3NjcmlwdD4KICAgIDxzY3JpcHQgdHlwZT0iYXBwbGljYXRpb24vamF2YXNjcmlwdCI+Y2xhc3MgSWNvc2FoZWRyb24gZXh0ZW5kcyBQdXp6bGUgewogICAgY29uc3RydWN0b3Ioc2l6ZSA9IDIsIGZ1bGxTcGFuID0gMjAwKSB7CiAgICAgICAgY29uc3QgZ3JpZCA9IHt9OwogICAgICAgIGNvbnN0IHN0aWNrZXJNYXAgPSB7fTsKICAgICAgICBjb25zdCBmYWNlcyA9IFtdOwogICAgICAgIGNvbnN0IGN5Y2xlcyA9IFtdOwogICAgICAgIGNvbnN0IGFscGhhTSA9IDIgKiBNYXRoLlBJIC8gNTsKICAgICAgICBjb25zdCBhbmltYXRpb25TdGVwcyA9IDEwOwogICAgICAgIGNvbnN0IGFuaW1hdGlvbkNvbmZpZyA9IHsKICAgICAgICAgICAgc3RlcHM6IGFuaW1hdGlvblN0ZXBzLAogICAgICAgICAgICBkQWxwaGE6IGFscGhhTSAvIGFuaW1hdGlvblN0ZXBzCiAgICAgICAgfTsKICAgICAgICBjb25zdCBzY2FsZWRVbml0ID0gZnVsbFNwYW4gLyAyOwogICAgICAgIGNvbnN0IHNjYWxlZFBoaSA9IHNjYWxlZFVuaXQgKiAoMSArIE1hdGguc3FydCg1KSkgLyAyOwogICAgICAgIGNvbnN0IHJvb3RQb2ludHMgPSBbCiAgICAgICAgICAgIG5ldyBQb2ludCgwLCBzY2FsZWRQaGksIHNjYWxlZFVuaXQsICdyMCcpLAogICAgICAgICAgICBuZXcgUG9pbnQoMCwgc2NhbGVkUGhpLCAtc2NhbGVkVW5pdCwgJ3IxJyksCiAgICAgICAgICAgIG5ldyBQb2ludCgwLCAtc2NhbGVkUGhpLCBzY2FsZWRVbml0LCAncjInKSwKICAgICAgICAgICAgbmV3IFBvaW50KDAsIC1zY2FsZWRQaGksIC1zY2FsZWRVbml0LCAncjMnKSwKCiAgICAgICAgICAgIG5ldyBQb2ludChzY2FsZWRQaGksIHNjYWxlZFVuaXQsIDAsICdyNCcpLAogICAgICAgICAgICBuZXcgUG9pbnQoc2NhbGVkUGhpLCAtc2NhbGVkVW5pdCwgMCwgJ3I1JyksCiAgICAgICAgICAgIG5ldyBQb2ludCgtc2NhbGVkUGhpLCBzY2FsZWRVbml0LCAwLCAncjYnKSwKICAgICAgICAgICAgbmV3IFBvaW50KC1zY2FsZWRQaGksIC1zY2FsZWRVbml0LCAwLCAncjcnKSwKCiAgICAgICAgICAgIG5ldyBQb2ludChzY2FsZWRVbml0LCAwLCBzY2FsZWRQaGksICdyOCcpLAogICAgICAgICAgICBuZXcgUG9pbnQoLXNjYWxlZFVuaXQsIDAsIHNjYWxlZFBoaSwgJ3I5JyksCiAgICAgICAgICAgIG5ldyBQb2ludChzY2FsZWRVbml0LCAwLCAtc2NhbGVkUGhpLCAncjEwJyksCiAgICAgICAgICAgIG5ldyBQb2ludCgtc2NhbGVkVW5pdCwgMCwgLXNjYWxlZFBoaSwgJ3IxMScpCiAgICAgICAgXTsKICAgICAgICBjb25zdCBmYWNlQ29uZmlnID0gWwogICAgICAgICAgICB7ICdwb2ludHMnOiBbcm9vdFBvaW50c1swXSwgcm9vdFBvaW50c1s0XSwgcm9vdFBvaW50c1sxXV0sICdjb2xvcic6ICd3aGl0ZScgfSwKICAgICAgICAgICAgeyAncG9pbnRzJzogW3Jvb3RQb2ludHNbMF0sIHJvb3RQb2ludHNbMV0sIHJvb3RQb2ludHNbNl1dLCAnY29sb3InOiAnYmx1ZScgfSwKICAgICAgICAgICAgeyAncG9pbnRzJzogW3Jvb3RQb2ludHNbMF0sIHJvb3RQb2ludHNbNl0sIHJvb3RQb2ludHNbOV1dLCAnY29sb3InOiAncmVkJyB9LAogICAgICAgICAgICB7ICdwb2ludHMnOiBbcm9vdFBvaW50c1swXSwgcm9vdFBvaW50c1s5XSwgcm9vdFBvaW50c1s4XV0sICdjb2xvcic6ICdsYXduZ3JlZW4nIH0sCiAgICAgICAgICAgIHsgJ3BvaW50cyc6IFtyb290UG9pbnRzWzBdLCByb290UG9pbnRzWzhdLCByb290UG9pbnRzWzRdXSwgJ2NvbG9yJzogJ3NreWJsdWUnIH0sCgogICAgICAgICAgICB7ICdwb2ludHMnOiBbcm9vdFBvaW50c1szXSwgcm9vdFBvaW50c1syXSwgcm9vdFBvaW50c1s3XV0sICdjb2xvcic6ICdvcmFuZ2UnIH0sCiAgICAgICAgICAgIHsgJ3BvaW50cyc6IFtyb290UG9pbnRzWzNdLCByb290UG9pbnRzWzVdLCByb290UG9pbnRzWzJdXSwgJ2NvbG9yJzogJ2RhcmtvbGl2ZWdyZWVuJyB9LAogICAgICAgICAgICB7ICdwb2ludHMnOiBbcm9vdFBvaW50c1szXSwgcm9vdFBvaW50c1sxMF0sIHJvb3RQb2ludHNbNV1dLCAnY29sb3InOiAneWVsbG93JyB9LAogICAgICAgICAgICB7ICdwb2ludHMnOiBbcm9vdFBvaW50c1szXSwgcm9vdFBvaW50c1sxMV0sIHJvb3RQb2ludHNbMTBdXSwgJ2NvbG9yJzogJ2xpZ2h0Z3JlZW4nIH0sCiAgICAgICAgICAgIHsgJ3BvaW50cyc6IFtyb290UG9pbnRzWzNdLCByb290UG9pbnRzWzddLCByb290UG9pbnRzWzExXV0sICdjb2xvcic6ICdzYWxtb24nIH0sCgogICAgICAgICAgICB7ICdwb2ludHMnOiBbcm9vdFBvaW50c1s0XSwgcm9vdFBvaW50c1s1XSwgcm9vdFBvaW50c1sxMF1dLCAnY29sb3InOiAnbWFnZW50YScgfSwKICAgICAgICAgICAgeyAncG9pbnRzJzogW3Jvb3RQb2ludHNbMV0sIHJvb3RQb2ludHNbMTBdLCByb290UG9pbnRzWzExXV0sICdjb2xvcic6ICdjcmltc29uJyB9LAogICAgICAgICAgICB7ICdwb2ludHMnOiBbcm9vdFBvaW50c1s2XSwgcm9vdFBvaW50c1sxMV0sIHJvb3RQb2ludHNbN11dLCAnY29sb3InOiAnaW5kaWdvJyB9LAogICAgICAgICAgICB7ICdwb2ludHMnOiBbcm9vdFBvaW50c1s5XSwgcm9vdFBvaW50c1s3XSwgcm9vdFBvaW50c1syXV0sICdjb2xvcic6ICdicm93bicgfSwKICAgICAgICAgICAgeyAncG9pbnRzJzogW3Jvb3RQb2ludHNbOF0sIHJvb3RQb2ludHNbMl0sIHJvb3RQb2ludHNbNV1dLCAnY29sb3InOiAnZGFya2JsdWUnIH0sCgogICAgICAgICAgICB7ICdwb2ludHMnOiBbcm9vdFBvaW50c1syXSwgcm9vdFBvaW50c1s4XSwgcm9vdFBvaW50c1s5XV0sICdjb2xvcic6ICdwaW5rJyB9LAogICAgICAgICAgICB7ICdwb2ludHMnOiBbcm9vdFBvaW50c1s1XSwgcm9vdFBvaW50c1s0XSwgcm9vdFBvaW50c1s4XV0sICdjb2xvcic6ICdidXJseXdvb2QnIH0sCiAgICAgICAgICAgIHsgJ3BvaW50cyc6IFtyb290UG9pbnRzWzEwXSwgcm9vdFBvaW50c1sxXSwgcm9vdFBvaW50c1s0XV0sICdjb2xvcic6ICdkYXJrY3lhbicgfSwKICAgICAgICAgICAgeyAncG9pbnRzJzogW3Jvb3RQb2ludHNbMTFdLCByb290UG9pbnRzWzZdLCByb290UG9pbnRzWzFdXSwgJ2NvbG9yJzogJ2RhcmttYWdlbnRhJyB9LAogICAgICAgICAgICB7ICdwb2ludHMnOiBbcm9vdFBvaW50c1s3XSwgcm9vdFBvaW50c1s5XSwgcm9vdFBvaW50c1s2XV0sICdjb2xvcic6ICdnb2xkZW5yb2QnIH0KICAgICAgICBdOwogICAgICAgIGZhY2VDb25maWcuZm9yRWFjaCgoZiwgaSkgPT4gZi5pZCA9IGkpOwogICAgICAgIGNvbnN0IGZhY2VTbGljZUNvbmZpZyA9IHt9OwogICAgICAgIGNvbnN0IGN5Y2xlRmFtaWx5Q29uZmlnID0gW107CiAgICAgICAgcm9vdFBvaW50cy5mb3JFYWNoKHBvaW50ID0+IHsKICAgICAgICAgICAgY29uc3Qgcm9vdElEID0gcG9pbnQuaWQ7CiAgICAgICAgICAgIGNvbnN0IGNvbmZpZyA9IHsgJ3Jvb3QnOiBwb2ludCwgZmFjZXM6IFtdIH07CiAgICAgICAgICAgIGNvbnN0IHBvaW50Q2hhaW4gPSBbXTsKICAgICAgICAgICAgbGV0IGZhY2UgPSBmYWNlQ29uZmlnLmZpbmQoKHsgcG9pbnRzIH0pID0+IHBvaW50cy5maW5kKHAgPT4gcC5pZCA9PSByb290SUQpKTsKICAgICAgICAgICAgY29uZmlnLmZhY2VzLnB1c2goZmFjZSk7CiAgICAgICAgICAgIHBvaW50Q2hhaW4ucHVzaChmYWNlLnBvaW50c1ttb2QoZmFjZS5wb2ludHMuZmluZEluZGV4KHAgPT4gcC5pZCA9PSByb290SUQpICsgMiwgMyldLmlkKTsKICAgICAgICAgICAgZm9yIChsZXQgYyA9IDA7IGMgPCA0OyBjKyspIHsKICAgICAgICAgICAgICAgIGxldCBwMGlkID0gcm9vdElEOwogICAgICAgICAgICAgICAgbGV0IHAxaWQgPSBmYWNlLnBvaW50c1ttb2QoZmFjZS5wb2ludHMuZmluZEluZGV4KHAgPT4gcC5pZCA9PSByb290SUQpICsgMSwgMyldLmlkOwogICAgICAgICAgICAgICAgbGV0IHAyaWQgPSBmYWNlLnBvaW50c1ttb2QoZmFjZS5wb2ludHMuZmluZEluZGV4KHAgPT4gcC5pZCA9PSByb290SUQpICsgMiwgMyldLmlkOwogICAgICAgICAgICAgICAgZmFjZSA9IGZhY2VDb25maWcuZmluZCgoeyBwb2ludHMgfSkgPT4KICAgICAgICAgICAgICAgICAgICAhcG9pbnRzLmZpbmQocCA9PiBwLmlkID09IHAxaWQpCiAgICAgICAgICAgICAgICAgICAgJiYgcG9pbnRzLmZpbmQocCA9PiBwLmlkID09IHAwaWQpCiAgICAgICAgICAgICAgICAgICAgJiYgcG9pbnRzLmZpbmQocCA9PiBwLmlkID09IHAyaWQpKTsKICAgICAgICAgICAgICAgIGNvbmZpZy5mYWNlcy5wdXNoKGZhY2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGN5Y2xlRmFtaWx5Q29uZmlnLnB1c2goY29uZmlnKTsKICAgICAgICB9KTsKICAgICAgICBmYWNlQ29uZmlnLmZvckVhY2goKHtwb2ludHMsIGNvbG9yfSwgZikgPT4gewogICAgICAgICAgICBjb25zdCBzdGlja2VycyA9IFtdOwogICAgICAgICAgICBjb25zdCBiYXNlVmVjdG9yID0gbmV3IFZlY3Rvcihwb2ludHNbMF0pOwogICAgICAgICAgICBjb25zdCB2SSA9IG5ldyBWZWN0b3IocG9pbnRzWzBdLCBwb2ludHNbMV0pLm11bHRpcGx5KDEgLyBzaXplKTsKICAgICAgICAgICAgY29uc3QgdkogPSBuZXcgVmVjdG9yKHBvaW50c1sxXSwgcG9pbnRzWzJdKS5tdWx0aXBseSgxIC8gc2l6ZSk7CiAgICAgICAgICAgIGxldCBwb2ludFZlY3RvciwgaSwgajsKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8PSBzaXplOyBpKyspIHsKICAgICAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPD0gaTsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgcG9pbnRWZWN0b3IgPSBiYXNlVmVjdG9yLmFkZCh2SS5tdWx0aXBseShpKSkuYWRkKHZKLm11bHRpcGx5KGopKTsKICAgICAgICAgICAgICAgICAgICBncmlkW2BwLSR7Zn0tJHtpfS0ke2p9YF0gPSBuZXcgUG9pbnQocG9pbnRWZWN0b3IueCwgcG9pbnRWZWN0b3IueSwgcG9pbnRWZWN0b3Iueik7CiAgICAgICAgICAgICAgICAgICAgaWYgKGkgJiYgaikgewogICAgICAgICAgICAgICAgICAgICAgICBzdGlja2Vycy5wdXNoKG5ldyBTdGlja2VyKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYHMtJHtmfS0ke2l9LSR7an1gLCBjb2xvciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmlkW2BwLSR7Zn0tJHtpIC0gMX0tJHtqIC0gMX1gXS5jbG9uZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRbYHAtJHtmfS0ke2l9LSR7aiAtIDF9YF0uY2xvbmUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmlkW2BwLSR7Zn0tJHtpfS0ke2p9YF0uY2xvbmUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICAgICAgKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0aWNrZXJNYXBbc3RpY2tlcnNbc3RpY2tlcnMubGVuZ3RoIC0gMV0uaWRdID0gc3RpY2tlcnNbc3RpY2tlcnMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqIDwgaSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RpY2tlcnMucHVzaChuZXcgU3RpY2tlcigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgcy0ke2Z9LSR7aX0tJHtqfS1yYCwgY29sb3IsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmlkW2BwLSR7Zn0tJHtpfS0ke2p9YF0uY2xvbmUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZFtgcC0ke2Z9LSR7aSAtIDF9LSR7an1gXS5jbG9uZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmlkW2BwLSR7Zn0tJHtpIC0gMX0tJHtqIC0gMX1gXS5jbG9uZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RpY2tlck1hcFtzdGlja2Vyc1tzdGlja2Vycy5sZW5ndGggLSAxXS5pZF0gPSBzdGlja2Vyc1tzdGlja2Vycy5sZW5ndGggLSAxXTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmYWNlcy5wdXNoKG5ldyBGYWNlKHN0aWNrZXJzKSk7CgogICAgICAgICAgICBjb25zdCBzbGljZUNvbmZpZyA9IHt9OwogICAgICAgICAgICBzbGljZUNvbmZpZ1twb2ludHNbMF0uaWRdID0gW107CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IHNpemU7IGkrKykgewogICAgICAgICAgICAgICAgbGV0IHNsaWNlID0gW10KICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAxOyBqIDw9IGk7IGorKykgewogICAgICAgICAgICAgICAgICAgIHNsaWNlLnB1c2goc3RpY2tlck1hcFtgcy0ke2Z9LSR7aX0tJHtqfWBdKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaiA8IGkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2xpY2UucHVzaChzdGlja2VyTWFwW2BzLSR7Zn0tJHtpfS0ke2p9LXJgXSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc2xpY2VDb25maWdbcG9pbnRzWzBdLmlkXS5wdXNoKHNsaWNlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzbGljZUNvbmZpZ1twb2ludHNbMV0uaWRdID0gW107CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IHNpemU7IGkrKykgewogICAgICAgICAgICAgICAgbGV0IHNsaWNlID0gW10KICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAxOyBqIDw9IGk7IGorKykgewogICAgICAgICAgICAgICAgICAgIHNsaWNlLnB1c2goc3RpY2tlck1hcFtgcy0ke2Z9LSR7c2l6ZSAtIChqIC0gMSl9LSR7aSAtIChqIC0gMSl9YF0pOwogICAgICAgICAgICAgICAgICAgIGlmIChqIDwgaSkgewogICAgICAgICAgICAgICAgICAgICAgICBzbGljZS5wdXNoKHN0aWNrZXJNYXBbYHMtJHtmfS0ke3NpemUgLSAoaiAtIDEpfS0ke2kgLSBqfS1yYF0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNsaWNlQ29uZmlnW3BvaW50c1sxXS5pZF0ucHVzaChzbGljZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2xpY2VDb25maWdbcG9pbnRzWzJdLmlkXSA9IFtdOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8PSBzaXplOyBpKyspIHsKICAgICAgICAgICAgICAgIGxldCBzbGljZSA9IFtdCiAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMTsgaiA8PSBpOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICBzbGljZS5wdXNoKHN0aWNrZXJNYXBbYHMtJHtmfS0ke3NpemUgKyAoaiAtIDEpIC0gKGkgLSAxKX0tJHtzaXplIC0gKGkgLSAxKX1gXSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGogPCBpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNsaWNlLnB1c2goc3RpY2tlck1hcFtgcy0ke2Z9LSR7c2l6ZSArIDEgKyAoaiAtIDEpIC0gKGkgLSAxKX0tJHtzaXplIC0gKGkgLSAxKX0tcmBdKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzbGljZUNvbmZpZ1twb2ludHNbMl0uaWRdLnB1c2goc2xpY2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZhY2VTbGljZUNvbmZpZ1tmXSA9IHNsaWNlQ29uZmlnOwogICAgICAgIH0pOwoKICAgICAgICBjeWNsZUZhbWlseUNvbmZpZy5mb3JFYWNoKCh7IGZhY2VzLCByb290IH0pID0+IHsKICAgICAgICAgICAgZm9yIChsZXQgYyA9IDA7IGMgPCBzaXplOyBjKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IHVuaXRWZWN0b3IgPSBuZXcgVmVjdG9yKHJvb3QpLnVuaXQoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHN0aWNrZXJDb2xsZWN0aW9ucyA9IFtBcnJheS5wcm90b3R5cGUuY29uY2F0LmFwcGx5KFtdLCBmYWNlcy5tYXAoKHsgaWQgfSkgPT4gZmFjZVNsaWNlQ29uZmlnW2lkXVtyb290LmlkXVtjXSkpXTsKICAgICAgICAgICAgICAgIGN5Y2xlcy5wdXNoKG5ldyBDeWNsZShzdGlja2VyQ29sbGVjdGlvbnMsIDUsIHVuaXRWZWN0b3IsIGFuaW1hdGlvbkNvbmZpZykpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgY3ljbGVzLmZvckVhY2goY3ljbGUgPT4gewogICAgICAgICAgICBjeWNsZS5zdGlja2VyQ29sbGVjdGlvbnNbMF0uaXNQcmltYXJ5ID0gdHJ1ZTsKICAgICAgICAgICAgY3ljbGUuY29tcHV0ZVN0aWNrZXJDb3ZlcigpCiAgICAgICAgfSk7CiAgICAgICAgc3VwZXIoZmFjZXMsIGN5Y2xlcyk7CgogICAgICAgIHRoaXMuc2F2ZU9yaWVudGF0aW9uKHsKICAgICAgICAgICAgJ2F4aXMnOiBuZXcgVmVjdG9yKHsgeDogMSwgeTogMCwgejogMH0pLAogICAgICAgICAgICAnYW5nbGUnOiAtIDI3ICogTWF0aC5QSSAvIDQwCiAgICAgICAgfSk7CiAgICB9Cn0KCjwvc2NyaXB0PgogICAgPHNjcmlwdCB0eXBlPSJhcHBsaWNhdGlvbi9qYXZhc2NyaXB0Ij4oKCkgPT4gewogICAgd2luZG93Lm1lbnVDb25maWcgPSB7CiAgICAgICAgcHV6emxlczogewogICAgICAgICAgICAndGV0cmFoZWRyb24nOiAoc2l6ZSwgaXNEZW1vKSA9PiBuZXcgVGV0cmFoZWRyb24oc2l6ZSwgaXNEZW1vID8gNDIuNSA6IHVuZGVmaW5lZCksCiAgICAgICAgICAgICdjdWJlJzogKHNpemUsIGlzRGVtbykgPT4gbmV3IEN1YmUoc2l6ZSwgaXNEZW1vID8gNTAgOiB1bmRlZmluZWQpLAogICAgICAgICAgICAnb2N0YWhlZHJvbic6IChzaXplLCBpc0RlbW8pID0+IG5ldyBPY3RhaGVkcm9uKHNpemUsIGlzRGVtbyA/IDQyLjUgOiB1bmRlZmluZWQpLAogICAgICAgICAgICAnZG9kZWNhaGVkcm9uJzogKHNpemUsIGlzRGVtbykgPT4gbmV3IERvZGVjYWhlZHJvbihzaXplLCBpc0RlbW8gPyA0Mi41IDogdW5kZWZpbmVkKSwKICAgICAgICAgICAgJ2ljb3NhaGVkcm9uJzogKHNpemUsIGlzRGVtbykgPT4gbmV3IEljb3NhaGVkcm9uKHNpemUsIGlzRGVtbyA/IDQyLjUgOiB1bmRlZmluZWQpCiAgICAgICAgfSwKICAgICAgICBzaXplczogewogICAgICAgICAgICAndGV0cmFoZWRyb24nOiBbMyw0LDVdLAogICAgICAgICAgICAnY3ViZSc6IFsyLDMsNF0sCiAgICAgICAgICAgICdvY3RhaGVkcm9uJzogWzIsMyw0XSwKICAgICAgICAgICAgJ2RvZGVjYWhlZHJvbic6IFsxLDIsM10sCiAgICAgICAgICAgICdpY29zYWhlZHJvbic6IFsyLDMsNF0KICAgICAgICB9CiAgICB9CgogICAgbGV0IG1lbnVTdGF0ZUNvdW50ZXIgPSAwOwoKICAgIHdpbmRvdy5zaG93U2hhcGVNZW51ID0gKCkgPT4gewogICAgICAgIG1lbnVTdGF0ZUNvdW50ZXIrKzsKICAgICAgICB3aW5kb3cucHV6emxlbWVudS5zdHlsZS5kaXNwbGF5ID0gd2luZG93LnNoYXBlbWVudS5zdHlsZS5kaXNwbGF5ID0gd2luZG93LnNldHRpbmdzbWVudWJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gJ2lubGluZS1ibG9jayc7CiAgICAgICAgd2luZG93LmNvbmZpZ3VyYXRpb25tZW51LnN0eWxlLmRpc3BsYXkgPSB3aW5kb3cucHV6emxlbWVudWJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gd2luZG93LnNpemVtZW51LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgbGV0IGxvY2FsU3RhdGUgPSBtZW51U3RhdGVDb3VudGVyOwogICAgICAgIGZvciAobGV0IGVsZW1JZCBpbiB3aW5kb3cubWVudUNvbmZpZy5wdXp6bGVzKSB7CiAgICAgICAgICAgIGNvbnN0IGN0eCA9IHdpbmRvd1tlbGVtSWRdLmdldENvbnRleHQoJzJkJyk7CiAgICAgICAgICAgIGNvbnN0IGNvbnN0cnVjdG9yID0gd2luZG93Lm1lbnVDb25maWcucHV6emxlc1tlbGVtSWRdOwogICAgICAgICAgICBjb25zdCBwdXp6bGUgPSBjb25zdHJ1Y3Rvcih1bmRlZmluZWQsIHRydWUpOwogICAgICAgICAgICBwdXp6bGUudXBkYXRlZE9yaWVudGF0aW9uID0gewogICAgICAgICAgICAgICAgJ2F4aXMnOiBuZXcgVmVjdG9yKHsgeDogMSwgeTogMSwgejogMCB9KSwKICAgICAgICAgICAgICAgICdhbmdsZSc6IDAKICAgICAgICAgICAgfTsKICAgICAgICAgICAgY3R4LnNldFRyYW5zZm9ybSgxLCAwLCAwLCAxLCAwLCAwKTsKICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZSg1MCwgNTApOwogICAgICAgICAgICBsZXQgbG9vcCA9ICgpID0+IHsKICAgICAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgICAgICBjdHguc2V0VHJhbnNmb3JtKDEsIDAsIDAsIDEsIDAsIDApOwogICAgICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBnYW1lQ2FudmFzLndpZHRoLCBnYW1lQ2FudmFzLmhlaWdodCk7CiAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgICAgICAgICAgcHV6emxlLnVwZGF0ZWRPcmllbnRhdGlvbi5hbmdsZSArPSAwLjAxNTsKICAgICAgICAgICAgICAgIHB1enpsZS51cGRhdGUoKTsKICAgICAgICAgICAgICAgIHB1enpsZS5yZW5kZXIoY3R4KTsKICAgICAgICAgICAgICAgIGlmIChtZW51U3RhdGVDb3VudGVyID09IGxvY2FsU3RhdGUpIHsKICAgICAgICAgICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUobG9vcCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGxvb3ApOwoKICAgICAgICAgICAgd2luZG93W2VsZW1JZF0ub25tb3VzZWRvd24gPSAoKSA9PiBzaG93U2l6ZU1lbnUoZWxlbUlkKTsKICAgICAgICB9CiAgICB9CgogICAgd2luZG93LnNob3dTaXplTWVudSA9IGVsZW1JZCA9PiB7CiAgICAgICAgbWVudVN0YXRlQ291bnRlcisrOwogICAgICAgIGxldCBsb2NhbFN0YXRlID0gbWVudVN0YXRlQ291bnRlcjsKICAgICAgICB3aW5kb3cuc2hhcGVtZW51LnN0eWxlLmRpc3BsYXkgPSB3aW5kb3cuc2V0dGluZ3NtZW51YnV0dG9uLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgd2luZG93LnNpemVtZW51LnN0eWxlLmRpc3BsYXkgPSB3aW5kb3cucHV6emxlbWVudWJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gImlubGluZS1ibG9jayI7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAzOyBpKyspIHsKICAgICAgICAgICAgY29uc3QgY3R4ID0gd2luZG93W2BzaXplLSR7aSArIDF9YF0uZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICAgICAgY29uc3QgY29uc3RydWN0b3IgPSB3aW5kb3cubWVudUNvbmZpZy5wdXp6bGVzW2VsZW1JZF07CiAgICAgICAgICAgIGNvbnN0IHB1enpsZVNpemUgPSB3aW5kb3cubWVudUNvbmZpZy5zaXplc1tlbGVtSWRdW2ldOwogICAgICAgICAgICBjb25zdCBwdXp6bGUgPSBjb25zdHJ1Y3RvcihwdXp6bGVTaXplLCB0cnVlKTsKICAgICAgICAgICAgcHV6emxlLnVwZGF0ZWRPcmllbnRhdGlvbiA9IHsKICAgICAgICAgICAgICAgICdheGlzJzogbmV3IFZlY3Rvcih7IHg6IDEsIHk6IDEsIHo6IDAgfSksCiAgICAgICAgICAgICAgICAnYW5nbGUnOiAwCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGN0eC5zZXRUcmFuc2Zvcm0oMSwgMCwgMCwgMSwgMCwgMCk7CiAgICAgICAgICAgIGN0eC50cmFuc2xhdGUoNTAsIDUwKTsKICAgICAgICAgICAgbGV0IGxvb3AgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICAgICAgY3R4LnNldFRyYW5zZm9ybSgxLCAwLCAwLCAxLCAwLCAwKTsKICAgICAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgZ2FtZUNhbnZhcy53aWR0aCwgZ2FtZUNhbnZhcy5oZWlnaHQpOwogICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICAgICAgICAgIHB1enpsZS51cGRhdGVkT3JpZW50YXRpb24uYW5nbGUgKz0gMC4wMTU7CiAgICAgICAgICAgICAgICBwdXp6bGUudXBkYXRlKCk7CiAgICAgICAgICAgICAgICBwdXp6bGUucmVuZGVyKGN0eCk7CiAgICAgICAgICAgICAgICBpZiAobWVudVN0YXRlQ291bnRlciA9PSBsb2NhbFN0YXRlKSB7CiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGxvb3ApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShsb29wKTsKCiAgICAgICAgICAgIHdpbmRvd1tgc2l6ZS0ke2kgKyAxfWBdLm9ubW91c2Vkb3duID0gKCkgPT4gewogICAgICAgICAgICAgICAgd2luZG93LnNlbGVjdGVkUHV6emxlID0gY29uc3RydWN0b3IocHV6emxlU2l6ZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgd2luZG93LnN0YXJ0YnV0dG9uLnN0eWxlLnZpc2liaWxpdHkgPSAndmlzaWJsZSc7CiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgfQoKICAgIHdpbmRvdy5zaG93U2V0dGluZ3NNZW51ID0gKCkgPT4gewogICAgICAgIHdpbmRvdy5wdXp6bGVtZW51LnN0eWxlLmRpc3BsYXkgPSB3aW5kb3cuc2V0dGluZ3NtZW51YnV0dG9uLnN0eWxlLmRpc3BsYXkgPSdub25lJzsKICAgICAgICB3aW5kb3cuY29uZmlndXJhdGlvbm1lbnUuc3R5bGUuZGlzcGxheSA9IHdpbmRvdy5wdXp6bGVtZW51YnV0dG9uLnN0eWxlLmRpc3BsYXk9J2lubGluZS1ibG9jayc7CiAgICB9CgogICAgd2luZG93LnNob3dTaGFwZU1lbnUoKTsKfSkoKTsKPC9zY3JpcHQ+CiAgICA8c2NyaXB0IHR5cGU9ImFwcGxpY2F0aW9uL2phdmFzY3JpcHQiPigoKSA9PiB7CgogICAgLy8gQmFzaWMgY29udGV4dCBjb25maWd1cmF0aW9uCiAgICBjb25zdCBjdHggPSBnYW1lQ2FudmFzLmdldENvbnRleHQoJzJkJyk7CiAgICBjb25zdCBjdHhJbnZlcnRlZCA9IGdhbWVDYW52YXNJbnZlcnRlZC5nZXRDb250ZXh0KCcyZCcpOwogICAgY3R4LnRyYW5zbGF0ZSgzMDAsIDMwMCk7CiAgICBjdHhJbnZlcnRlZC5zY2FsZSgxIC8gMywgMSAvIDMpOwogICAgY3R4SW52ZXJ0ZWQudHJhbnNsYXRlKDMwMCwgMzAwKTsKCgogICAgY29uc3QgZ2V0RXZlbnRPZmZzZXQgPSAoKSA9PiB7CiAgICAgICAgY29uc3QgZ2FtZUNhbnZhc1JlY3QgPSBnYW1lQ2FudmFzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICd4JzogZ2FtZUNhbnZhc1JlY3QubGVmdCArIDMwMCwKICAgICAgICAgICAgJ3knOiBnYW1lQ2FudmFzUmVjdC50b3AgKyAzMDAKICAgICAgICB9CiAgICB9CgogICAgLy8gSW5pdGlhbCBnYW1lIGNvbmZpZ3VyYXRpb24KICAgIHdpbmRvdy5leHBsb2RlZFN0aWNrZXJzID0gdHJ1ZTsKCiAgICB3aW5kb3cuc2VsZWN0ZWRQdXp6bGUgPSBuZXcgVGV0cmFoZWRyb24oKTsKICAgIFB1enpsZS5wcm90b3R5cGUub25GaW5pc2ggPSB0aW1lID0+IHsKICAgICAgICB3aW5kb3cuaGVscC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIHdpbmRvdy5tZW51LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgd2luZG93LnN0YXJ0YnV0dG9uLnN0eWxlLnZpc2liaWxpdHkgPSAndmlzaWJsZSc7CiAgICAgICAgd2luZG93LnN1Y2Nlc3Muc3R5bGUuZGlzcGxheSA9ICdpbmxpbmUtYmxvY2snOwogICAgICAgIHdpbmRvdy5tZXNzYWdlLmlubmVySFRNTCA9IGBZb3Ugc29sdmVkIGl0IGluICR7dGltZX0gc2Vjb25kcy48YnIvPiBHb29kIEpvYi5gOwogICAgfQoKICAgIC8vIEdhbWUgbG9vcAogICAgbGV0IGxvb3AgPSAoKSA9PiB7CiAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICBjdHguc2V0VHJhbnNmb3JtKDEsIDAsIDAsIDEsIDAsIDApOwogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgZ2FtZUNhbnZhcy53aWR0aCwgZ2FtZUNhbnZhcy5oZWlnaHQpOwogICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgd2luZG93LnNlbGVjdGVkUHV6emxlLnVwZGF0ZSgpOwogICAgICAgIHdpbmRvdy5zZWxlY3RlZFB1enpsZS5yZW5kZXIoY3R4LCBmYWxzZSwgd2luZG93LmV4cGxvZGVkU3RpY2tlcnMpOwoKICAgICAgICBpZiAod2luZG93LnNob3dSZWFyVmlldykgewogICAgICAgICAgICBjdHhJbnZlcnRlZC5zYXZlKCk7CiAgICAgICAgICAgIGN0eEludmVydGVkLnNldFRyYW5zZm9ybSgxLCAwLCAwLCAxLCAwLCAwKTsKICAgICAgICAgICAgY3R4SW52ZXJ0ZWQuY2xlYXJSZWN0KDAsIDAsIGdhbWVDYW52YXMud2lkdGgsIGdhbWVDYW52YXMuaGVpZ2h0KTsKICAgICAgICAgICAgY3R4SW52ZXJ0ZWQucmVzdG9yZSgpOwogICAgICAgICAgICB3aW5kb3cuc2VsZWN0ZWRQdXp6bGUucmVuZGVyKGN0eEludmVydGVkLCB0cnVlLCB3aW5kb3cuZXhwbG9kZWRTdGlja2Vycyk7CiAgICAgICAgfQoKICAgICAgICBpZiAod2luZG93LnNlbGVjdGVkUHV6emxlLnN0YXJ0VGltZSkgewogICAgICAgICAgICBsZXQgdGltZUluU2Vjb25kcyA9IE1hdGguZmxvb3IoKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gd2luZG93LnNlbGVjdGVkUHV6emxlLnN0YXJ0VGltZSkgLyAxMDAwKTsKICAgICAgICAgICAgbGV0IG1pbnV0ZXMgPSBgJHtNYXRoLmZsb29yKHRpbWVJblNlY29uZHMgLyA2MCl9YDsKICAgICAgICAgICAgbGV0IHNlY29uZHMgPSBgJHt0aW1lSW5TZWNvbmRzICUgNjB9YDsKICAgICAgICAgICAgaWYgKG1pbnV0ZXMubGVuZ3RoIDwgMikgbWludXRlcyA9ICcwJyArIG1pbnV0ZXM7CiAgICAgICAgICAgIGlmIChzZWNvbmRzLmxlbmd0aCA8IDIpIHNlY29uZHMgPSAnMCcgKyBzZWNvbmRzOwogICAgICAgICAgICB3aW5kb3cuc3RhdHMuaW5uZXJIVE1MID0gYFRpbWUgVGFrZW46ICR7bWludXRlc306JHtzZWNvbmRzfSwgTW92ZXMgTWFkZTogJHt3aW5kb3cuc2VsZWN0ZWRQdXp6bGUubW92ZXNNYWRlfWAKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB3aW5kb3cuc3RhdHMuaW5uZXJIVE1MID0gYFRpbWUgVGFrZW46IC0tOi0tLCBNb3ZlcyBNYWRlOiAtLWAKICAgICAgICB9CgogICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShsb29wKTsKICAgIH0KICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShsb29wKTsKCiAgICAvLyBNb3VzZSBldmVudCBoYW5kbGVycwogICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY29udGV4dG1lbnUnLCBldmVudCA9PiBldmVudC5wcmV2ZW50RGVmYXVsdCgpKTsKICAgIGdhbWVDYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgZSA9PiB7CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgY29uc3QgZXZlbnRPZmZzZXQgPSBnZXRFdmVudE9mZnNldCgpOwogICAgICAgIHdpbmRvdy5zZWxlY3RlZFB1enpsZS5ncmFiKGUuY2xpZW50WCAtIGV2ZW50T2Zmc2V0LngsIGUuY2xpZW50WSAtIGV2ZW50T2Zmc2V0LnksIGUuY3RybEtleSA/IDIgOiBlLmJ1dHRvbik7CiAgICB9KQoKICAgIGdhbWVDYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgZSA9PiB7CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgY29uc3QgZXZlbnRPZmZzZXQgPSBnZXRFdmVudE9mZnNldCgpOwogICAgICAgIHdpbmRvdy5zZWxlY3RlZFB1enpsZS5kcmFnKGUuY2xpZW50WCAtIGV2ZW50T2Zmc2V0LngsIGUuY2xpZW50WSAtIGV2ZW50T2Zmc2V0LnkpOwogICAgfSkKCiAgICBnYW1lQ2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBlID0+IHsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICB3aW5kb3cuc2VsZWN0ZWRQdXp6bGUucmVsZWFzZSgpOwogICAgfSkKCiAgICBnYW1lQ2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbGVhdmUnLCBlID0+IHsKICAgICAgICB3aW5kb3cuc2VsZWN0ZWRQdXp6bGUucmVsZWFzZSgpOwogICAgfSkKCn0pKCk7Cjwvc2NyaXB0Pgo8L2JvZHk+Cgo8L2h0bWw+Cg==">Twisty Polyhedra</a></b>
